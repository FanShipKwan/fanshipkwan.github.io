<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>因缺斯汀</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="PYTHON数据分析（PANDAS IX – 数据聚合）标签： PYTHON科学计算


转载自实验楼作者 木木同学 的课程[《PYTHON数据分析》][1]

一、实验介绍　　对于聚合，我指的是任何能够从数组产生标量值的数据转换过程。上一节实验课的例子中，我们已经用过一些，比如 mean、count、min 以及 sum 等。你可能想知道在 GroupBy 对象上调用 mean()时究竟发生了什">
<meta property="og:type" content="article">
<meta property="og:title" content="因缺斯汀">
<meta property="og:url" content="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/index.html">
<meta property="og:site_name" content="因缺斯汀">
<meta property="og:description" content="PYTHON数据分析（PANDAS IX – 数据聚合）标签： PYTHON科学计算


转载自实验楼作者 木木同学 的课程[《PYTHON数据分析》][1]

一、实验介绍　　对于聚合，我指的是任何能够从数组产生标量值的数据转换过程。上一节实验课的例子中，我们已经用过一些，比如 mean、count、min 以及 sum 等。你可能想知道在 GroupBy 对象上调用 mean()时究竟发生了什">
<meta property="og:updated_time" content="2016-05-17T15:56:55.819Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="因缺斯汀">
<meta name="twitter:description" content="PYTHON数据分析（PANDAS IX – 数据聚合）标签： PYTHON科学计算


转载自实验楼作者 木木同学 的课程[《PYTHON数据分析》][1]

一、实验介绍　　对于聚合，我指的是任何能够从数组产生标量值的数据转换过程。上一节实验课的例子中，我们已经用过一些，比如 mean、count、min 以及 sum 等。你可能想知道在 GroupBy 对象上调用 mean()时究竟发生了什">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/open-sans/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
    

</head>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">因缺斯汀</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/123.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Cari" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'pos',
            PAGES: 'Pages',
            CATEGORIES: 'kategori',
            TAGS: 'tag',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Cari" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/123.png" />
            <h2 id="name">FanShip</h2>
            <h3 id="title">Local Farmer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>GuangZhou, China</span>
            <a id="follow" target="_blank" href="https://github.com/fanshipkwan/">IKUTI</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                13
                <span>pos</span>
            </div>
            <div class="article-info-block">
                0
                <span>tag</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    <td><a href="https://github.com/FanShipKwan/" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
                    
                    <td><a href="http://weibo.com/u/1846194245" target="_blank" title="weibo"><i class="fa fa-weibo"></i></a></td>
                    
                    <td><a href="/" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-PYTHON数据分析（PANDAS-IX-数据聚合）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="PYTHON数据分析（PANDAS-IX-–-数据聚合）"><a href="#PYTHON数据分析（PANDAS-IX-–-数据聚合）" class="headerlink" title="PYTHON数据分析（PANDAS IX – 数据聚合）"></a>PYTHON数据分析（PANDAS IX – 数据聚合）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　　对于聚合，我指的是任何能够从数组产生标量值的数据转换过程。上一节实验课的例子中，我们已经用过一些，比如 mean、count、min 以及 sum 等。你可能想知道在 GroupBy 对象上调用 mean()时究竟发生了什么。<br><a id="more"></a><br>　　<strong>许多常见的聚合运算都有就地计算数据集统计信息的优化实现。</strong><br>|函数名    |说明<br>|–|<br>|count    |分组中非 NA 值的数量<br>|sum    |非 NA 值的和<br>|mean    |非 NA 值的平均值<br>|median    |非 NA 值的算术中位数<br>|std、var    |无偏（分母为你n-1）标准差和方差<br>|min、max    |非 NA 值的最小值和最大值<br>|prop    |非 NA 值的积<br>|first、last    |第一个和最后一个非 NA 值</p>
<p>　　然而，并不是只能使用这些方法。我们可以使用自己发明的聚合运算，还可以调用分组对象已经定义好的任何方法。例如，<code>quantile</code> 可以计算 Series 或 DataFrame 列的样本分位数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [28]: df = DataFrame(&#123;&apos;key1&apos;:[&apos;a&apos;,&apos;a&apos;,&apos;b&apos;,&apos;b&apos;,&apos;a&apos;],</span><br><span class="line">                &apos;key2&apos;:[&apos;one&apos;,&apos;two&apos;,&apos;one&apos;,&apos;two&apos;,&apos;one&apos;],</span><br><span class="line">                &apos;data1&apos;:np.random.randn(5),</span><br><span class="line">                &apos;data2&apos;:np.random.randn(5)&#125;)</span><br><span class="line"></span><br><span class="line">In [29]: df</span><br><span class="line">Out[29]: </span><br><span class="line">      data1     data2 key1 key2</span><br><span class="line">0  1.569326  0.129858    a  one</span><br><span class="line">1 -2.535518 -1.749728    a  two</span><br><span class="line">2 -0.225235  0.799330    b  one</span><br><span class="line">3 -0.342218  1.061132    b  two</span><br><span class="line">4 -0.605917 -1.925334    a  one</span><br><span class="line"></span><br><span class="line">In [30]: grouped = df.groupby(&apos;key1&apos;)</span><br><span class="line"></span><br><span class="line">In [31]: grouped[&apos;data1&apos;].quantile(0.9)</span><br><span class="line">Out[31]: </span><br><span class="line">key1</span><br><span class="line">a    1.134277</span><br><span class="line">b   -0.236933</span><br><span class="line">Name: data1, dtype: float64</span><br></pre></td></tr></table></figure></p>
<p>　　虽然 <code>quantile</code> 并没有明确地实现于 GroupBy，但它是一个 Series 方法，所以这里是能用的。实际上，GroupBy 会高效地对 Series 进行切片，然后对各片调用 <code>piece.quantile(0.9)</code>，最后将这些结果组装成最终结果。</p>
<p>　　如果要使用你自己的聚合函数，只需将其传入 <code>aggregate</code> 或 <code>agg</code> 方法即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [32]: def peak_to_peak(arr):</span><br><span class="line">   ....:     return arr.max() - arr.min()</span><br><span class="line">   ....: </span><br><span class="line"></span><br><span class="line">In [33]: grouped.agg(peak_to_peak)</span><br><span class="line">Out[33]: </span><br><span class="line">         data1     data2</span><br><span class="line">key1                    </span><br><span class="line">a     4.104844  2.055192</span><br><span class="line">b     0.116983  0.261802</span><br></pre></td></tr></table></figure></p>
<p>　　注意，有些方法（如 <code>describe</code>）也是可以用在这里的，即使严格来讲，它们并非聚合运算：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [34]: grouped.describe()</span><br><span class="line">Out[34]: </span><br><span class="line">               data1     data2</span><br><span class="line">key1                          </span><br><span class="line">a    count  3.000000  3.000000</span><br><span class="line">     mean  -0.524037 -1.181735</span><br><span class="line">     std    2.053647  1.139261</span><br><span class="line">     min   -2.535518 -1.925334</span><br><span class="line">     25%   -1.570718 -1.837531</span><br><span class="line">     50%   -0.605917 -1.749728</span><br><span class="line">     75%    0.481704 -0.809935</span><br><span class="line">     max    1.569326  0.129858</span><br><span class="line">b    count  2.000000  2.000000</span><br><span class="line">     mean  -0.283727  0.930231</span><br><span class="line">     std    0.082720  0.185122</span><br><span class="line">     min   -0.342218  0.799330</span><br><span class="line">     25%   -0.312973  0.864781</span><br><span class="line">     50%   -0.283727  0.930231</span><br><span class="line">     75%   -0.254481  0.995681</span><br><span class="line">     max   -0.225235  1.061132</span><br></pre></td></tr></table></figure></p>
<h2 id="二、面向列的多函数应用"><a href="#二、面向列的多函数应用" class="headerlink" title="二、面向列的多函数应用"></a><strong>二、面向列的多函数应用</strong></h2><p>　　为了说明一些更高级的聚合功能，我将使用一个关于餐馆小费的数据集，同样的，同学们将下面的数据贴在文本文件里，等会儿会用到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">total_bill,tip,sex,smoker,day,time,size</span><br><span class="line">16.99,1.01,Female,No,Sun,Dinner,2</span><br><span class="line">10.34,1.66,Male,No,Sun,Dinner,3</span><br><span class="line">21.01,3.5,Male,No,Sun,Dinner,3</span><br><span class="line">23.68,3.31,Male,No,Sun,Dinner,2</span><br><span class="line">24.59,3.61,Female,No,Sun,Dinner,4</span><br><span class="line">25.29,4.71,Male,No,Sun,Dinner,4</span><br><span class="line">8.77,2.0,Male,No,Sun,Dinner,2</span><br><span class="line">26.88,3.12,Male,No,Sun,Dinner,4</span><br><span class="line">15.04,1.96,Male,No,Sun,Dinner,2</span><br><span class="line">14.78,3.23,Male,No,Sun,Dinner,2</span><br><span class="line">10.27,1.71,Male,No,Sun,Dinner,2</span><br><span class="line">35.26,5.0,Female,No,Sun,Dinner,4</span><br><span class="line">15.42,1.57,Male,No,Sun,Dinner,2</span><br><span class="line">18.43,3.0,Male,No,Sun,Dinner,4</span><br><span class="line">14.83,3.02,Female,No,Sun,Dinner,2</span><br><span class="line">21.58,3.92,Male,No,Sun,Dinner,2</span><br><span class="line">10.33,1.67,Female,No,Sun,Dinner,3</span><br><span class="line">16.29,3.71,Male,No,Sun,Dinner,3</span><br><span class="line">16.97,3.5,Female,No,Sun,Dinner,3</span><br><span class="line">20.65,3.35,Male,No,Sat,Dinner,3</span><br><span class="line">17.92,4.08,Male,No,Sat,Dinner,2</span><br><span class="line">20.29,2.75,Female,No,Sat,Dinner,2</span><br><span class="line">15.77,2.23,Female,No,Sat,Dinner,2</span><br><span class="line">39.42,7.58,Male,No,Sat,Dinner,4</span><br><span class="line">19.82,3.18,Male,No,Sat,Dinner,2</span><br><span class="line">17.81,2.34,Male,No,Sat,Dinner,4</span><br><span class="line">13.37,2.0,Male,No,Sat,Dinner,2</span><br><span class="line">12.69,2.0,Male,No,Sat,Dinner,2</span><br><span class="line">21.7,4.3,Male,No,Sat,Dinner,2</span><br><span class="line">19.65,3.0,Female,No,Sat,Dinner,2</span><br><span class="line">9.55,1.45,Male,No,Sat,Dinner,2</span><br><span class="line">18.35,2.5,Male,No,Sat,Dinner,4</span><br><span class="line">15.06,3.0,Female,No,Sat,Dinner,2</span><br><span class="line">20.69,2.45,Female,No,Sat,Dinner,4</span><br><span class="line">17.78,3.27,Male,No,Sat,Dinner,2</span><br><span class="line">24.06,3.6,Male,No,Sat,Dinner,3</span><br><span class="line">16.31,2.0,Male,No,Sat,Dinner,3</span><br><span class="line">16.93,3.07,Female,No,Sat,Dinner,3</span><br><span class="line">18.69,2.31,Male,No,Sat,Dinner,3</span><br><span class="line">31.27,5.0,Male,No,Sat,Dinner,3</span><br><span class="line">16.04,2.24,Male,No,Sat,Dinner,3</span><br><span class="line">17.46,2.54,Male,No,Sun,Dinner,2</span><br><span class="line">13.94,3.06,Male,No,Sun,Dinner,2</span><br><span class="line">9.68,1.32,Male,No,Sun,Dinner,2</span><br><span class="line">30.4,5.6,Male,No,Sun,Dinner,4</span><br><span class="line">18.29,3.0,Male,No,Sun,Dinner,2</span><br><span class="line">22.23,5.0,Male,No,Sun,Dinner,2</span><br><span class="line">32.4,6.0,Male,No,Sun,Dinner,4</span><br><span class="line">28.55,2.05,Male,No,Sun,Dinner,3</span><br><span class="line">18.04,3.0,Male,No,Sun,Dinner,2</span><br><span class="line">12.54,2.5,Male,No,Sun,Dinner,2</span><br><span class="line">10.29,2.6,Female,No,Sun,Dinner,2</span><br><span class="line">34.81,5.2,Female,No,Sun,Dinner,4</span><br><span class="line">9.94,1.56,Male,No,Sun,Dinner,2</span><br><span class="line">25.56,4.34,Male,No,Sun,Dinner,4</span><br><span class="line">19.49,3.51,Male,No,Sun,Dinner,2</span><br><span class="line">38.01,3.0,Male,Yes,Sat,Dinner,4</span><br><span class="line">26.41,1.5,Female,No,Sat,Dinner,2</span><br><span class="line">11.24,1.76,Male,Yes,Sat,Dinner,2</span><br><span class="line">48.27,6.73,Male,No,Sat,Dinner,4</span><br><span class="line">20.29,3.21,Male,Yes,Sat,Dinner,2</span><br><span class="line">13.81,2.0,Male,Yes,Sat,Dinner,2</span><br><span class="line">11.02,1.98,Male,Yes,Sat,Dinner,2</span><br><span class="line">18.29,3.76,Male,Yes,Sat,Dinner,4</span><br><span class="line">17.59,2.64,Male,No,Sat,Dinner,3</span><br><span class="line">20.08,3.15,Male,No,Sat,Dinner,3</span><br><span class="line">16.45,2.47,Female,No,Sat,Dinner,2</span><br><span class="line">3.07,1.0,Female,Yes,Sat,Dinner,1</span><br><span class="line">20.23,2.01,Male,No,Sat,Dinner,2</span><br><span class="line">15.01,2.09,Male,Yes,Sat,Dinner,2</span><br><span class="line">12.02,1.97,Male,No,Sat,Dinner,2</span><br><span class="line">17.07,3.0,Female,No,Sat,Dinner,3</span><br><span class="line">26.86,3.14,Female,Yes,Sat,Dinner,2</span><br><span class="line">25.28,5.0,Female,Yes,Sat,Dinner,2</span><br><span class="line">14.73,2.2,Female,No,Sat,Dinner,2</span><br><span class="line">10.51,1.25,Male,No,Sat,Dinner,2</span><br><span class="line">17.92,3.08,Male,Yes,Sat,Dinner,2</span><br><span class="line">27.2,4.0,Male,No,Thur,Lunch,4</span><br><span class="line">22.76,3.0,Male,No,Thur,Lunch,2</span><br><span class="line">17.29,2.71,Male,No,Thur,Lunch,2</span><br><span class="line">19.44,3.0,Male,Yes,Thur,Lunch,2</span><br><span class="line">16.66,3.4,Male,No,Thur,Lunch,2</span><br><span class="line">10.07,1.83,Female,No,Thur,Lunch,1</span><br><span class="line">32.68,5.0,Male,Yes,Thur,Lunch,2</span><br><span class="line">15.98,2.03,Male,No,Thur,Lunch,2</span><br><span class="line">34.83,5.17,Female,No,Thur,Lunch,4</span><br></pre></td></tr></table></figure></p>
<p>　　我们已经看到，对 Series 或 DataFrame 列的聚合运算其实就是使用 <code>aggregate</code>（使用自定义函数）或调用诸如 <code>mean</code>、<code>std</code> 之类的方法。然而，你可能希望对不同的列使用不同的聚合函数，或一次应用多个函数。其实这事也好办，我将通过一些示例来进行讲解。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">In [35]: tips = pd.read_csv(&apos;tips.csv&apos;)</span><br><span class="line"></span><br><span class="line">In [36]: # 添加“小费占总额百分比”的列</span><br><span class="line"></span><br><span class="line">In [37]: tips[&apos;tip_pct&apos;] = tips[&apos;tip&apos;]/tips[&apos;total_bill&apos;]</span><br><span class="line"></span><br><span class="line">In [38]: tips[:6]</span><br><span class="line">Out[38]: </span><br><span class="line">   total_bill   tip     sex smoker  day    time  size   tip_pct</span><br><span class="line">0       16.99  1.01  Female     No  Sun  Dinner     2  0.059447</span><br><span class="line">1       10.34  1.66    Male     No  Sun  Dinner     3  0.160542</span><br><span class="line">2       21.01  3.50    Male     No  Sun  Dinner     3  0.166587</span><br><span class="line">3       23.68  3.31    Male     No  Sun  Dinner     2  0.139780</span><br><span class="line">4       24.59  3.61  Female     No  Sun  Dinner     4  0.146808</span><br><span class="line">5       25.29  4.71    Male     No  Sun  Dinner     4  0.186240</span><br><span class="line"></span><br><span class="line">In [39]: #首先，我们根据 sex 和 smoker 对 tips 进行分组</span><br><span class="line"></span><br><span class="line">In [40]: grouped = tips.groupby([&apos;sex&apos;,&apos;smoker&apos;])</span><br><span class="line"></span><br><span class="line">In [41]: # 注意，统计函数名可以以字符串的形式传入</span><br><span class="line"></span><br><span class="line">In [42]: grouped_pct = grouped[&apos;tip_pct&apos;]</span><br><span class="line"></span><br><span class="line">In [43]: grouped_pct.agg(&apos;mean&apos;)</span><br><span class="line">Out[43]: </span><br><span class="line">sex     smoker</span><br><span class="line">Female  No        0.156921</span><br><span class="line">        Yes       0.182150</span><br><span class="line">Male    No        0.160669</span><br><span class="line">        Yes       0.152771</span><br><span class="line">Name: tip_pct, dtype: float64</span><br><span class="line">In [44]: #如果传入一组函数或函数名</span><br><span class="line"></span><br><span class="line">In [45]: #得到的 DataFrame 列就会以相应的函数命名</span><br><span class="line"></span><br><span class="line">In [46]: grouped_pct.agg([&apos;mean&apos;,&apos;std&apos;,peak_to_peak])</span><br><span class="line">Out[46]: </span><br><span class="line">                   mean       std  peak_to_peak</span><br><span class="line">sex    smoker                                  </span><br><span class="line">Female No      0.156921  0.036421      0.195876</span><br><span class="line">       Yes     0.182150  0.071595      0.360233</span><br><span class="line">Male   No      0.160669  0.041849      0.220186</span><br><span class="line">       Yes     0.152771  0.090588      0.674707</span><br><span class="line"></span><br><span class="line">In [47]: #当然我们并非一定要接受 GroupBy 自动给出的列名</span><br><span class="line"></span><br><span class="line">In [48]: #我们可以传入（name，function） 元组就可以</span><br><span class="line"></span><br><span class="line">In [49]: grouped_pct.agg([(&apos;foo&apos;,&apos;mean&apos;),(&apos;bar&apos;,np.std)])</span><br><span class="line">Out[49]: </span><br><span class="line">                    foo       bar</span><br><span class="line">sex    smoker                    </span><br><span class="line">Female No      0.156921  0.036421</span><br><span class="line">       Yes     0.182150  0.071595</span><br><span class="line">Male   No      0.160669  0.041849</span><br><span class="line">       Yes     0.152771  0.090588</span><br></pre></td></tr></table></figure></p>
<p>　　对于 DataFrame，我们还可以定义一组应用于全部列的函数，或不同的列应用不同的函数。假设我们想要对 <code>tip_pct</code> 和 <code>total_bill</code> 列计算三个统计信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [54]: functions = [&apos;count&apos;,&apos;mean&apos;,&apos;max&apos;]</span><br><span class="line"></span><br><span class="line">In [55]: result = grouped[&apos;tip_pct&apos;,</span><br><span class="line">                 &apos;total_bill&apos;].agg(functions)</span><br><span class="line"></span><br><span class="line">In [56]: result</span><br><span class="line">Out[56]: </span><br><span class="line">              tip_pct                     total_bill                  </span><br><span class="line">                count      mean       max      count       mean    max</span><br><span class="line">sex    smoker                                                         </span><br><span class="line">Female No          54  0.156921  0.252672         54  18.105185  35.83</span><br><span class="line">       Yes         33  0.182150  0.416667         33  17.977879  44.30</span><br><span class="line">Male   No          97  0.160669  0.291990         97  19.791237  48.33</span><br><span class="line">       Yes         60  0.152771  0.710345         60  22.284500  50.81</span><br></pre></td></tr></table></figure>
<p>　　如你所见，结果 DataFrame 拥有层次化的列，这相当于分别对各列进行聚合，然后用 <code>concat</code> 将结果组装到一起<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [57]: result[&apos;tip_pct&apos;]</span><br><span class="line">Out[57]: </span><br><span class="line">               count      mean       max</span><br><span class="line">sex    smoker                           </span><br><span class="line">Female No         54  0.156921  0.252672</span><br><span class="line">       Yes        33  0.182150  0.416667</span><br><span class="line">Male   No         97  0.160669  0.291990</span><br><span class="line">       Yes        60  0.152771  0.710345</span><br><span class="line"></span><br><span class="line">In [58]: # 这里可以传入带有自定义名称的元组列表</span><br><span class="line"></span><br><span class="line">In [59]:  ftuples=[(&apos;Durchschnitt&apos;,&apos;mean&apos;),</span><br><span class="line">   ....:           (&apos;Abweichung&apos;,np.var)]</span><br><span class="line"></span><br><span class="line">In [60]: grouped[&apos;tip_pct&apos;,&apos;total_bill&apos;].agg(ftuples)</span><br><span class="line">Out[60]: </span><br><span class="line">                   tip_pct              total_bill           </span><br><span class="line">              Durchschnitt Abweichung Durchschnitt Abweichung</span><br><span class="line">sex    smoker                                                </span><br><span class="line">Female No         0.156921   0.001327    18.105185  53.092422</span><br><span class="line">       Yes        0.182150   0.005126    17.977879  84.451517</span><br><span class="line">Male   No         0.160669   0.001751    19.791237  76.152961</span><br><span class="line">       Yes        0.152771   0.008206    22.284500  98.244673</span><br></pre></td></tr></table></figure></p>
<p>　　现在我们要对不同的列应用不同的函数。具体的办法是向 <code>agg</code> 传入一个从列名映射到函数的字典：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [61]: grouped.agg(&#123;&apos;tip&apos;:np.max,&apos;size&apos;:&apos;sum&apos;&#125;)</span><br><span class="line">Out[61]: </span><br><span class="line">                tip  size</span><br><span class="line">sex    smoker            </span><br><span class="line">Female No       5.2   140</span><br><span class="line">       Yes      6.5    74</span><br><span class="line">Male   No       9.0   263</span><br><span class="line">       Yes     10.0   150</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [62]: grouped.agg(&#123;&apos;tip_pct&apos;:[&apos;min&apos;,&apos;max&apos;,</span><br><span class="line">   ....: &apos;mean&apos;,&apos;std&apos;],&apos;size&apos;:&apos;sum&apos;&#125;)</span><br><span class="line">Out[62]: </span><br><span class="line">                tip_pct                               size</span><br><span class="line">                    min       max      mean       std  sum</span><br><span class="line">sex    smoker                                             </span><br><span class="line">Female No      0.056797  0.252672  0.156921  0.036421  140</span><br><span class="line">       Yes     0.056433  0.416667  0.182150  0.071595   74</span><br><span class="line">Male   No      0.071804  0.291990  0.160669  0.041849  263</span><br><span class="line">       Yes     0.035638  0.710345  0.152771  0.090588  150</span><br><span class="line">```       </span><br><span class="line">　　只有将多个函数应用到至少一列时，DataFrame 才会拥有层次化的列。 　　</span><br><span class="line"></span><br><span class="line">## **三、以“无索引”的形式返回聚合数据**</span><br><span class="line"></span><br><span class="line">　　到目前为止，所有示例中的聚合数据都有由唯一的分组键组成的索引（可能还是层次化的）。由于并不总是需要如此，所以你可以向 groupby 传入 `as_index=False` 以禁用该功能</span><br></pre></td></tr></table></figure></p>
<p>In [64]: tips.groupby([‘sex’,’smoker’],<br>   ….: as_index=False).mean()<br>Out[64]:<br>      sex smoker  total_bill       tip      size   tip_pct<br>0  Female     No   18.105185  2.773519  2.592593  0.156921<br>1  Female    Yes   17.977879  2.931515  2.242424  0.182150<br>2    Male     No   19.791237  3.113402  2.711340  0.160669<br>3    Male    Yes   22.284500  3.051167  2.500000  0.152771<br>```</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/">Komentar</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Lebih baru</strong>
            <div class="article-nav-title">
                
                    (no title)
                
            </div>
        </a>
    
    
        <a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Lebih Tua</strong>
            <div class="article-nav-title"></div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div class="ds-thread" data-thread-key="2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" data-title="" data-url="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/"></div>
    <style>
        #ds-thread #ds-reset .ds-textarea-wrapper {
            background: none;
        }
        #ds-reset .ds-avatar img {
            box-shadow: none;
        }
        #ds-reset .ds-gradient-bg {
            background: #f7f7f7;
        }
        #ds-thread #ds-reset li.ds-tab a {
            border-radius: 3px;
        }
        #ds-thread #ds-reset .ds-post-button {
            color: white;
            border: none;
            box-shadow: none;
            background: #d32;
            text-shadow: none;
            font-weight: normal;
            font-family: 'Microsoft Yahei';
        }
        #ds-thread #ds-reset .ds-post-button:hover {
            color: white;
            background: #DE594C;
        }
        #ds-thread #ds-reset .ds-post-button:active {
            background: #d32;
        }
        #ds-smilies-tooltip ul.ds-smilies-tabs li a.ds-current {
            color: white;
            background: #d32;
            box-shadow: none;
            text-shadow: none;
            font-weight: normal;
        }
    </style>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">terbaru</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:57:16.339Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:57:09.034Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:55.751Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:49.830Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:43.698Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">arsip</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tautan</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2016 FanShipKwan<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'freefarm'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>