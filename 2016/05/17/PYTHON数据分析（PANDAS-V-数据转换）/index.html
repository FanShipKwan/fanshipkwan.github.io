<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>因缺斯汀</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="PYTHON数据分析（PANDAS V –数据转换）标签： PYTHON科学计算


转载自实验楼作者 木木同学 的课程[《PYTHON数据分析》][1]

一、实验介绍　到目前为止，之前介绍的都是数据的重排。而另一类重要操作则是过滤、清理以及其他的转换工作。今天我们就来更深入的学习数据的转换知识吧！
二、移除重复数据　　DataFrame 中常常会出现重复行，举个例子：1234567891011">
<meta property="og:type" content="article">
<meta property="og:title" content="因缺斯汀">
<meta property="og:url" content="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/index.html">
<meta property="og:site_name" content="因缺斯汀">
<meta property="og:description" content="PYTHON数据分析（PANDAS V –数据转换）标签： PYTHON科学计算


转载自实验楼作者 木木同学 的课程[《PYTHON数据分析》][1]

一、实验介绍　到目前为止，之前介绍的都是数据的重排。而另一类重要操作则是过滤、清理以及其他的转换工作。今天我们就来更深入的学习数据的转换知识吧！
二、移除重复数据　　DataFrame 中常常会出现重复行，举个例子：1234567891011">
<meta property="og:updated_time" content="2016-05-17T15:56:25.168Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="因缺斯汀">
<meta name="twitter:description" content="PYTHON数据分析（PANDAS V –数据转换）标签： PYTHON科学计算


转载自实验楼作者 木木同学 的课程[《PYTHON数据分析》][1]

一、实验介绍　到目前为止，之前介绍的都是数据的重排。而另一类重要操作则是过滤、清理以及其他的转换工作。今天我们就来更深入的学习数据的转换知识吧！
二、移除重复数据　　DataFrame 中常常会出现重复行，举个例子：1234567891011">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/open-sans/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
    

</head>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">因缺斯汀</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/123.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Cari" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'pos',
            PAGES: 'Pages',
            CATEGORIES: 'kategori',
            TAGS: 'tag',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Cari" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/123.png" />
            <h2 id="name">FanShip</h2>
            <h3 id="title">Local Farmer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>GuangZhou, China</span>
            <a id="follow" target="_blank" href="https://github.com/fanshipkwan/">IKUTI</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                13
                <span>pos</span>
            </div>
            <div class="article-info-block">
                0
                <span>tag</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    <td><a href="https://github.com/FanShipKwan/" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
                    
                    <td><a href="http://weibo.com/u/1846194245" target="_blank" title="weibo"><i class="fa fa-weibo"></i></a></td>
                    
                    <td><a href="/" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-PYTHON数据分析（PANDAS-V-数据转换）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="PYTHON数据分析（PANDAS-V-–数据转换）"><a href="#PYTHON数据分析（PANDAS-V-–数据转换）" class="headerlink" title="PYTHON数据分析（PANDAS V –数据转换）"></a>PYTHON数据分析（PANDAS V –数据转换）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　到目前为止，之前介绍的都是数据的重排。而另一类重要操作则是过滤、清理以及其他的转换工作。今天我们就来更深入的学习数据的转换知识吧！</p>
<h2 id="二、移除重复数据"><a href="#二、移除重复数据" class="headerlink" title="二、移除重复数据"></a><strong>二、移除重复数据</strong></h2><p>　　DataFrame 中常常会出现重复行，举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">In [5]: data = DataFrame(&#123;&apos;k1&apos;:[&apos;one&apos;]*3+[&apos;two&apos;]*4,</span><br><span class="line">                  &apos;k2&apos;:[1,1,2,3,3,4,4]&#125;)</span><br><span class="line"></span><br><span class="line">In [6]: data</span><br><span class="line">Out[6]: </span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">1  one   1</span><br><span class="line">2  one   2</span><br><span class="line">3  two   3</span><br><span class="line">4  two   3</span><br><span class="line">5  two   4</span><br><span class="line">6  two   4</span><br><span class="line"></span><br><span class="line">In [7]: #DataFrame 的 duplicated 方法返回一个布尔型 Seriess</span><br><span class="line"></span><br><span class="line">In [8]: # 表示各行是否是重复行</span><br><span class="line"></span><br><span class="line">In [9]:  data.duplicated()</span><br><span class="line">Out[9]: </span><br><span class="line">0    False</span><br><span class="line">1     True</span><br><span class="line">2    False</span><br><span class="line">3    False</span><br><span class="line">4     True</span><br><span class="line">5    False</span><br><span class="line">6     True</span><br><span class="line">dtype: bool</span><br><span class="line"></span><br><span class="line">In [10]: #drop_duplicates 方法，用于返回一个移除了重复行的 DataFrame</span><br><span class="line"></span><br><span class="line">In [11]: data.drop_duplicates()</span><br><span class="line">Out[11]: </span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">2  one   2</span><br><span class="line">3  two   3</span><br><span class="line">5  two   4</span><br><span class="line"></span><br><span class="line">In [12]: # 这个方法默认会判断全部列</span><br><span class="line"></span><br><span class="line">In [13]: #当然我们也可以指定部分列进行重复判断</span><br><span class="line"></span><br><span class="line">In [14]: data[&apos;v1&apos;] = range(7)</span><br><span class="line"></span><br><span class="line">In [15]: data</span><br><span class="line">Out[15]: </span><br><span class="line">    k1  k2  v1</span><br><span class="line">0  one   1   0</span><br><span class="line">1  one   1   1</span><br><span class="line">2  one   2   2</span><br><span class="line">3  two   3   3</span><br><span class="line">4  two   3   4</span><br><span class="line">5  two   4   5</span><br><span class="line">6  two   4   6</span><br><span class="line"></span><br><span class="line">In [16]: data.drop_duplicates([&apos;k1&apos;])</span><br><span class="line">Out[16]: </span><br><span class="line">    k1  k2  v1</span><br><span class="line">0  one   1   0</span><br><span class="line">3  two   3   3</span><br><span class="line"></span><br><span class="line">In [17]: # 上面是只通过k1列过滤重复项</span><br><span class="line">　　duplicated 和 drop_duplicates 默认保留的是第一个出现的值组合。传入 take_last = True 则保留最后一个：</span><br><span class="line"></span><br><span class="line">In [18]: data.drop_duplicates([&apos;k1&apos;,&apos;k2&apos;],take_last = True)</span><br><span class="line">Out[18]: </span><br><span class="line">    k1  k2  v1</span><br><span class="line">1  one   1   1</span><br><span class="line">2  one   2   2</span><br><span class="line">4  two   3   4</span><br><span class="line">6  two   4   6</span><br></pre></td></tr></table></figure></p>
<h2 id="三、利用函数或映射进行数据转换"><a href="#三、利用函数或映射进行数据转换" class="headerlink" title="三、利用函数或映射进行数据转换"></a><strong>三、利用函数或映射进行数据转换</strong></h2><p>　　在对数据集进行转换时，我们希望根据数组、<code>Series</code> 或 <code>DataFrame</code> 列中的值来实现工作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">In [4]: data = DataFrame(&#123;&apos;food&apos;:[&apos;bacon&apos;,&apos;pulled pork&apos;,&apos;bacon&apos;,</span><br><span class="line">   ...:                           &apos;pastrami&apos;,&apos;corned beef&apos;,&apos;bacon&apos;,</span><br><span class="line">   ...:                           &apos;pastrami&apos;,&apos;honey ham&apos;,&apos;nova lox&apos;],</span><br><span class="line">   ...:                   &apos;ounces&apos;:[4, 3, 12, 6, 7.5, 8, 3, 5, 6]&#125;)</span><br><span class="line"></span><br><span class="line">In [5]: data</span><br><span class="line">Out[5]: </span><br><span class="line">          food  ounces</span><br><span class="line">0        bacon     4.0</span><br><span class="line">1  pulled pork     3.0</span><br><span class="line">2        bacon    12.0</span><br><span class="line">3     pastrami     6.0</span><br><span class="line">4  corned beef     7.5</span><br><span class="line">5        bacon     8.0</span><br><span class="line">6     pastrami     3.0</span><br><span class="line">7    honey ham     5.0</span><br><span class="line">8     nova lox     6.0</span><br><span class="line"></span><br><span class="line">In [6]: # 我们添加一个食物来源</span><br><span class="line"></span><br><span class="line">In [7]:  meat_to_animal = &#123;</span><br><span class="line">   ...: &apos;bacon&apos;: &apos;pig&apos;,</span><br><span class="line">   ...: &apos;pulled pork&apos;: &apos;pig&apos;,</span><br><span class="line">   ...: &apos;pastrami&apos;: &apos;cow&apos;,</span><br><span class="line">   ...: &apos;corned beef&apos;: &apos;cow&apos;,</span><br><span class="line">   ...: &apos;honey ham&apos;: &apos;pig&apos;,</span><br><span class="line">   ...: &apos;nova lox&apos;: &apos;salmon&apos;</span><br><span class="line">   ...: &#125;</span><br><span class="line"></span><br><span class="line">In [8]: #Series 的 map 方法可以接受一个函数或含有映射关系的字典型对象</span><br><span class="line"></span><br><span class="line">In [9]: data[&apos;animal&apos;] = data[&apos;food&apos;].map(meat_to_animal)</span><br><span class="line"></span><br><span class="line">In [10]: data</span><br><span class="line">Out[10]: </span><br><span class="line">          food  ounces  animal</span><br><span class="line">0        bacon     4.0     pig</span><br><span class="line">1  pulled pork     3.0     pig</span><br><span class="line">2        bacon    12.0     pig</span><br><span class="line">3     pastrami     6.0     cow</span><br><span class="line">4  corned beef     7.5     cow</span><br><span class="line">5        bacon     8.0     pig</span><br><span class="line">6     pastrami     3.0     cow</span><br><span class="line">7    honey ham     5.0     pig</span><br><span class="line">8     nova lox     6.0  salmon</span><br><span class="line"></span><br><span class="line">In [11]: # 我们也可以传入一个能够完成全部工作的函数：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [12]: data[&apos;food&apos;].map(lambda x: meat_to_animal[x])</span><br><span class="line">Out[12]: </span><br><span class="line">0       pig</span><br><span class="line">1       pig</span><br><span class="line">2       pig</span><br><span class="line">3       cow</span><br><span class="line">4       cow</span><br><span class="line">5       pig</span><br><span class="line">6       cow</span><br><span class="line">7       pig</span><br><span class="line">8    salmon</span><br><span class="line">Name: food, dtype: object</span><br><span class="line">　　使用 map 是一种实现元素级转换以及其他数据清理工作的便捷方式。</span><br></pre></td></tr></table></figure></p>
<h2 id="四、替换值"><a href="#四、替换值" class="headerlink" title="四、替换值"></a><strong>四、替换值</strong></h2><p>　　利用 fillna 方法填充缺失数据可以看做值替换的一种特殊情况。虽然前面提到的 map 可用于修改对象的数据子集，而 replace 则提供了一种实现该功能的更简单、更灵活的方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">In [20]: data = Series([1., -999., 2., -999., -1000., 3.])</span><br><span class="line"></span><br><span class="line">In [21]: data</span><br><span class="line">Out[21]: </span><br><span class="line">0       1</span><br><span class="line">1    -999</span><br><span class="line">2       2</span><br><span class="line">3    -999</span><br><span class="line">4   -1000</span><br><span class="line">5       3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [22]: #接下来我想将-999 换成 NAN</span><br><span class="line"></span><br><span class="line">In [23]: data.replace(-999, np.nan)</span><br><span class="line">Out[23]: </span><br><span class="line">0       1</span><br><span class="line">1     NaN</span><br><span class="line">2       2</span><br><span class="line">3     NaN</span><br><span class="line">4   -1000</span><br><span class="line">5       3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [24]: # 如果我们想一次性换多个值</span><br><span class="line"></span><br><span class="line">In [25]:  data.replace([-999,-1000],np.nan)</span><br><span class="line">Out[25]: </span><br><span class="line">0     1</span><br><span class="line">1   NaN</span><br><span class="line">2     2</span><br><span class="line">3   NaN</span><br><span class="line">4   NaN</span><br><span class="line">5     3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [26]: data.replace([-999,-1000],[np.nan, 0])</span><br><span class="line">Out[26]: </span><br><span class="line">0     1</span><br><span class="line">1   NaN</span><br><span class="line">2     2</span><br><span class="line">3   NaN</span><br><span class="line">4     0</span><br><span class="line">5     3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [27]: data.replace(&#123;-999: np.nan, -1000: 0&#125;)</span><br><span class="line">Out[27]: </span><br><span class="line">0     1</span><br><span class="line">1   NaN</span><br><span class="line">2     2</span><br><span class="line">3   NaN</span><br><span class="line">4     0</span><br><span class="line">5     3</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure></p>
<h2 id="五、重命名轴索引"><a href="#五、重命名轴索引" class="headerlink" title="五、重命名轴索引"></a><strong>五、重命名轴索引</strong></h2><p>　　跟 Series 中的值一样，轴标签也可以通过函数或映射进行转换，从而得到一个新对象。轴还可以被就地修改，而无需新建一个数据结构。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">In [28]: data = DataFrame(np.arange(12).reshape((3,4)),</span><br><span class="line">   ....:                  index = [&apos;Ohio&apos;,&apos;Colorado&apos;,&apos;New York&apos;],</span><br><span class="line">   ....:                  columns = [&apos;one&apos;,&apos;two&apos;,&apos;three&apos;,&apos;four&apos;])</span><br><span class="line"></span><br><span class="line">In [29]: # 跟 Series 一样，轴标签也有一个 map 方法</span><br><span class="line"></span><br><span class="line">In [30]: data.index.map(str.upper)</span><br><span class="line">Out[30]: array([&apos;OHIO&apos;, &apos;COLORADO&apos;, &apos;NEW YORK&apos;], dtype=object)</span><br><span class="line"></span><br><span class="line">In [31]: # 同样我们也可以赋值给 index</span><br><span class="line"></span><br><span class="line">In [32]: data.index = data.index.map(str.upper)</span><br><span class="line"></span><br><span class="line">In [33]: data</span><br><span class="line">Out[33]: </span><br><span class="line">          one  two  three  four</span><br><span class="line">OHIO        0    1      2     3</span><br><span class="line">COLORADO    4    5      6     7</span><br><span class="line">NEW YORK    8    9     10    11</span><br><span class="line"></span><br><span class="line">In [34]: # 如果想要创建数据集的转换版（不是修改原始数据）</span><br><span class="line"></span><br><span class="line">In [35]: data.rename(index = str.title,columns = str.upper)</span><br><span class="line">Out[35]: </span><br><span class="line">          ONE  TWO  THREE  FOUR</span><br><span class="line">Ohio        0    1      2     3</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line">New York    8    9     10    11</span><br><span class="line"></span><br><span class="line">In [36]: #rename 可以结合字典对象实现部分轴标签的更新</span><br><span class="line"></span><br><span class="line">In [37]: data.rename(index=&#123;&apos;OHIO&apos;:&apos;INDIANA&apos;&#125;,</span><br><span class="line">   ....:             columns = &#123;&apos;three&apos;:&apos;peekaboo&apos;&#125;)</span><br><span class="line">Out[37]: </span><br><span class="line">          one  two  peekaboo  four</span><br><span class="line">INDIANA     0    1         2     3</span><br><span class="line">COLORADO    4    5         6     7</span><br><span class="line">NEW YORK    8    9        10    11</span><br></pre></td></tr></table></figure></p>
<h2 id="六、离散化和面元划分"><a href="#六、离散化和面元划分" class="headerlink" title="六、离散化和面元划分"></a><strong>六、离散化和面元划分</strong></h2><p>　　为了便于分析，连续数据常常被离散化或拆分为“面元”（bin）。假设有一组人员数据，我们希望将它们划分为不同的年龄组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">In [39]: ages = [20, 22, 25, 27, 21, 23, 24, 18, 37, 31,61, 42, 48, 32]</span><br><span class="line"></span><br><span class="line">In [40]: # 接下来我们将这些数据分成18~25、26~35、35~60和60岁以上</span><br><span class="line"></span><br><span class="line">In [41]:  bins = [18, 25, 35, 60, 100]</span><br><span class="line"></span><br><span class="line">In [42]: cats = pd.cut(ages,bins)</span><br><span class="line"></span><br><span class="line">In [43]: cats</span><br><span class="line">Out[43]: </span><br><span class="line">[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]</span><br><span class="line">Length: 14</span><br><span class="line">Categories (4, object): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]</span><br><span class="line"></span><br><span class="line">In [44]: #pandas  用 cut 函数返回的是一个特殊的 Categorical 对象</span><br><span class="line"></span><br><span class="line">In [45]: #我们可以将其看做一组表示面元名称的字符串</span><br><span class="line"></span><br><span class="line">In [46]: #它含有一个表示不同分类名称的 levels 数组</span><br><span class="line"></span><br><span class="line">In [47]: cats.levels</span><br><span class="line">Out[47]: Index([u&apos;(18, 25]&apos;, u&apos;(25, 35]&apos;, u&apos;(35, 60]&apos;, u&apos;(60, 100]&apos;], dtype=&apos;object&apos;)</span><br><span class="line"></span><br><span class="line">In [48]: # 还有一个为年龄数据进行标号的 labels 属性</span><br><span class="line"></span><br><span class="line">In [49]:  cats.labels</span><br><span class="line">Out[49]: array([ 0,  0,  0,  1,  0,  0,  0, -1,  2,  1,  3,  2,  2,  1], dtype=int8)</span><br><span class="line"></span><br><span class="line">In [50]: pd.value_counts(cats)</span><br><span class="line">Out[50]: </span><br><span class="line">(18, 25]     6</span><br><span class="line">(35, 60]     3</span><br><span class="line">(25, 35]     3</span><br><span class="line">(60, 100]    1</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
<p>　　<br>　　如果向 cut 传入的是面元的数量而不是确切的面元边界，则它会根据数据的最小值和最大值计算等长面元。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [56]: data = np.random.rand(20)</span><br><span class="line"></span><br><span class="line">In [57]: pd.cut(data, 4, precision = 2)</span><br><span class="line">Out[57]: </span><br><span class="line">[(0.72, 0.96], (0.25, 0.49], (0.49, 0.72], (0.72, 0.96], (0.25, 0.49], ..., (0.014, 0.25], (0.72, 0.96], (0.49, 0.72], (0.25, 0.49], (0.72, 0.96]]</span><br><span class="line">Length: 20</span><br><span class="line">Categories (4, object): [(0.014, 0.25] &lt; (0.25, 0.49] &lt; (0.49, 0.72] &lt; (0.72, 0.96]]</span><br></pre></td></tr></table></figure>
<p>　　<code>qcut</code> 是一个非常类似于<code>cut</code>的函数，它可以根据样本分位数对数据进行面元划分。根据数据的分布情况，<code>cut</code>可能无法使各个面元含有相同数量的数据点。而<code>qcut</code>由于使用的是样本分位数，因此可以得到大小基本相等的面元：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [58]: data = np.random.randn(1000)</span><br><span class="line"></span><br><span class="line">In [59]: cats = pd.qcut(data,4)</span><br><span class="line"></span><br><span class="line">In [60]: cats</span><br><span class="line">Out[60]: </span><br><span class="line">[(-0.699, 0.0415], [-3.0467, -0.699], (0.0415, 0.731], (0.731, 3.0755], [-3.0467, -0.699], ..., (0.0415, 0.731], [-3.0467, -0.699], (-0.699, 0.0415], [-3.0467, -0.699], [-3.0467, -0.699]]</span><br><span class="line">Length: 1000</span><br><span class="line">Categories (4, object): [[-3.0467, -0.699] &lt; (-0.699, 0.0415] &lt; (0.0415, 0.731] &lt; (0.731, 3.0755]]</span><br><span class="line"></span><br><span class="line">In [61]: pd.value_counts(cats)</span><br><span class="line">Out[61]: </span><br><span class="line">(0.731, 3.0755]      250</span><br><span class="line">(0.0415, 0.731]      250</span><br><span class="line">(-0.699, 0.0415]     250</span><br><span class="line">[-3.0467, -0.699]    250</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure></p>
<h2 id="七、检测和过滤异常值"><a href="#七、检测和过滤异常值" class="headerlink" title="七、检测和过滤异常值"></a><strong>七、检测和过滤异常值</strong></h2><p>　　异常值（outlier）的过滤或变换运算在很大程度上其实就是数组运算。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">In [63]: np.random.seed(12345)</span><br><span class="line"></span><br><span class="line">In [64]: data = DataFrame(np.random.randn(1000,4))</span><br><span class="line"></span><br><span class="line">In [65]: data.describe()</span><br><span class="line">Out[65]: </span><br><span class="line">                 0            1            2            3</span><br><span class="line">count  1000.000000  1000.000000  1000.000000  1000.000000</span><br><span class="line">mean     -0.067684     0.067924     0.025598    -0.002298</span><br><span class="line">std       0.998035     0.992106     1.006835     0.996794</span><br><span class="line">min      -3.428254    -3.548824    -3.184377    -3.745356</span><br><span class="line">25%      -0.774890    -0.591841    -0.641675    -0.644144</span><br><span class="line">50%      -0.116401     0.101143     0.002073    -0.013611</span><br><span class="line">75%       0.616366     0.780282     0.680391     0.654328</span><br><span class="line">max       3.366626     2.653656     3.260383     3.927528</span><br><span class="line"></span><br><span class="line">In [66]: # 假设你想要找出某列中绝对值大小超过3的值</span><br><span class="line"></span><br><span class="line">In [67]:  col = data[3]</span><br><span class="line"></span><br><span class="line">In [68]: col[np.abs(col) &gt; 3]</span><br><span class="line">Out[68]: </span><br><span class="line">97     3.927528</span><br><span class="line">305   -3.399312</span><br><span class="line">400   -3.745356</span><br><span class="line">Name: 3, dtype: float64</span><br><span class="line"></span><br><span class="line">In [69]: # 要选出全部的绝对值大于三的行</span><br><span class="line"></span><br><span class="line">In [70]: data[(np.abs(data)&gt;3).any(1)]</span><br><span class="line">Out[70]: </span><br><span class="line">            0         1         2         3</span><br><span class="line">5   -0.539741  0.476985  3.248944 -1.021228</span><br><span class="line">97  -0.774363  0.552936  0.106061  3.927528</span><br><span class="line">102 -0.655054 -0.565230  3.176873  0.959533</span><br><span class="line">305 -2.315555  0.457246 -0.025907 -3.399312</span><br><span class="line">324  0.050188  1.951312  3.260383  0.963301</span><br><span class="line">400  0.146326  0.508391 -0.196713 -3.745356</span><br><span class="line">499 -0.293333 -0.242459 -3.056990  1.918403</span><br><span class="line">523 -3.428254 -0.296336 -0.439938 -0.867165</span><br><span class="line">586  0.275144  1.179227 -3.184377  1.369891</span><br><span class="line">808 -0.362528 -3.548824  1.553205 -2.186301</span><br><span class="line">900  3.366626 -2.372214  0.851010  1.332846</span><br><span class="line"></span><br><span class="line">In [71]: #根据这些条件，既可以轻松对值进行设置</span><br><span class="line"></span><br><span class="line">In [72]:  data[np.abs(data)&gt;3] = np.sign(data)*3</span><br><span class="line"></span><br><span class="line">In [73]: data.describe()</span><br><span class="line">Out[73]: </span><br><span class="line">                 0            1            2            3</span><br><span class="line">count  1000.000000  1000.000000  1000.000000  1000.000000</span><br><span class="line">mean     -0.067623     0.068473     0.025153    -0.002081</span><br><span class="line">std       0.995485     0.990253     1.003977     0.989736</span><br><span class="line">min      -3.000000    -3.000000    -3.000000    -3.000000</span><br><span class="line">25%      -0.774890    -0.591841    -0.641675    -0.644144</span><br><span class="line">50%      -0.116401     0.101143     0.002073    -0.013611</span><br><span class="line">75%       0.616366     0.780282     0.680391     0.654328</span><br><span class="line">max       3.000000     2.653656     3.000000     3.000000</span><br></pre></td></tr></table></figure></p>
<h2 id="八、排列和随机采样"><a href="#八、排列和随机采样" class="headerlink" title="八、排列和随机采样"></a><strong>八、排列和随机采样</strong></h2><p>　　利用 numpy.random.permutation 函数可以轻松实现对 Series 和 DataFrame 的列的排列工作（permuting，随机重排序）。通过需要排列的轴的长度调用 permutation，产生一个表示新顺序的整数数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [74]: df = DataFrame(np.arange(20).reshape(5,4))</span><br><span class="line"></span><br><span class="line">In [75]: sampler = np.random.permutation(5)</span><br><span class="line"></span><br><span class="line">In [76]: sampler</span><br><span class="line">Out[76]: array([1, 0, 2, 3, 4])</span><br><span class="line"></span><br><span class="line">In [77]: # 然后就可以在基于 ix 的索引操作或 take 函数中使用该数组</span><br><span class="line"></span><br><span class="line">In [78]:  df</span><br><span class="line">Out[78]: </span><br><span class="line">    0   1   2   3</span><br><span class="line">0   0   1   2   3</span><br><span class="line">1   4   5   6   7</span><br><span class="line">2   8   9  10  11</span><br><span class="line">3  12  13  14  15</span><br><span class="line">4  16  17  18  19</span><br><span class="line"></span><br><span class="line">In [79]: df.take(sampler)</span><br><span class="line">Out[79]: </span><br><span class="line">    0   1   2   3</span><br><span class="line">1   4   5   6   7</span><br><span class="line">0   0   1   2   3</span><br><span class="line">2   8   9  10  11</span><br><span class="line">3  12  13  14  15</span><br><span class="line">4  16  17  18  19</span><br></pre></td></tr></table></figure></p>
<p>　　如果不想用替换的方式选取随机子集，则可以使用 <code>permutation：</code>从 <code>permutation</code> 返回的数组中切下前 k 个元素，其中 k 为希望的子集大小。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [81]: df.take(np.random.permutation(len(df))[:3])</span><br><span class="line">Out[81]: </span><br><span class="line">    0   1   2   3</span><br><span class="line">1   4   5   6   7</span><br><span class="line">3  12  13  14  15</span><br><span class="line">4  16  17  18  19</span><br></pre></td></tr></table></figure></p>
<h2 id="九、计算指标-哑变量"><a href="#九、计算指标-哑变量" class="headerlink" title="九、计算指标/哑变量"></a><strong>九、计算指标/哑变量</strong></h2><p>　　另一种常用于统计建模或机器学习的转换方式：将分类变量（categorical variable）转换为“哑变量矩阵”（dummy matrix）或“指标矩阵”（indicator matrix）。如果 DataFrame 的某一列中含有 k 个不同的值，则可以派生出一个 k 列矩阵或 DataFrame（其值全为1和0）。pandas 有一个 get_dummies 函数可以实现该功能：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">In [89]: df = DataFrame(&#123;&apos;key&apos;:[&apos;b&apos;,&apos;b&apos;,&apos;a&apos;,&apos;c&apos;,&apos;a&apos;,&apos;b&apos;],</span><br><span class="line">   ....:                 &apos;data1&apos;:range(6)&#125;)</span><br><span class="line"></span><br><span class="line">In [90]: pd.get_dummies(df[&apos;key&apos;])</span><br><span class="line">Out[90]: </span><br><span class="line">   a  b  c</span><br><span class="line">0  0  1  0</span><br><span class="line">1  0  1  0</span><br><span class="line">2  1  0  0</span><br><span class="line">3  0  0  1</span><br><span class="line">4  1  0  0</span><br><span class="line">5  0  1  0</span><br><span class="line"></span><br><span class="line">In [91]: df</span><br><span class="line">Out[91]: </span><br><span class="line">   data1 key</span><br><span class="line">0      0   b</span><br><span class="line">1      1   b</span><br><span class="line">2      2   a</span><br><span class="line">3      3   c</span><br><span class="line">4      4   a</span><br><span class="line">5      5   b</span><br><span class="line"></span><br><span class="line">In [92]: # 我们可能想给指标 DataFrame 的列加上一个前缀，以便合并</span><br><span class="line"></span><br><span class="line">In [93]: dummies = pd.get_dummies(df[&apos;key&apos;],prefix = &apos;key&apos;)</span><br><span class="line"></span><br><span class="line">In [94]: df_with_dummy = df[[&apos;data1&apos;]].join(dummies)</span><br><span class="line"></span><br><span class="line">In [95]: df_with_dummy</span><br><span class="line">Out[95]: </span><br><span class="line">   data1  key_a  key_b  key_c</span><br><span class="line">0      0      0      1      0</span><br><span class="line">1      1      0      1      0</span><br><span class="line">2      2      1      0      0</span><br><span class="line">3      3      0      0      1</span><br><span class="line">4      4      1      0      0</span><br><span class="line">5      5      0      1      0</span><br></pre></td></tr></table></figure></p>
<p>　　如果 DataFrame 中的某行同属于多个分类，则事情就会有点复杂。同样的同学们，木木这里给大家一个数据文件，同学们把他们粘贴到文本文件中，等会会用到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1::Toy Story (1995)::Animation|Children&apos;s|Comedy</span><br><span class="line">2::Jumanji (1995)::Adventure|Children&apos;s|Fantasy</span><br><span class="line">3::Grumpier Old Men (1995)::Comedy|Romance</span><br><span class="line">4::Waiting to Exhale (1995)::Comedy|Drama</span><br><span class="line">5::Father of the Bride Part II (1995)::Comedy</span><br><span class="line">6::Heat (1995)::Action|Crime|Thriller</span><br><span class="line">7::Sabrina (1995)::Comedy|Romance</span><br><span class="line">8::Tom and Huck (1995)::Adventure|Children&apos;s</span><br><span class="line">9::Sudden Death (1995)::Action</span><br><span class="line">10::GoldenEye (1995)::Action|Adventure|Thriller</span><br><span class="line">11::American President, The (1995)::Comedy|Drama|Romance</span><br><span class="line">12::Dracula: Dead and Loving It (1995)::Comedy|Horror</span><br><span class="line">13::Balto (1995)::Animation|Children&apos;s</span><br><span class="line">14::Nixon (1995)::Drama</span><br><span class="line">15::Cutthroat Island (1995)::Action|Adventure|Romance</span><br><span class="line">16::Casino (1995)::Drama|Thriller</span><br><span class="line">17::Sense and Sensibility (1995)::Drama|Romance</span><br><span class="line">18::Four Rooms (1995)::Thriller</span><br><span class="line">19::Ace Ventura: When Nature Calls (1995)::Comedy</span><br><span class="line">20::Money Train (1995)::Action</span><br><span class="line">21::Get Shorty (1995)::Action|Comedy|Drama</span><br><span class="line">22::Copycat (1995)::Crime|Drama|Thriller</span><br><span class="line">23::Assassins (1995)::Thriller</span><br><span class="line">24::Powder (1995)::Drama|Sci-Fi</span><br><span class="line">25::Leaving Las Vegas (1995)::Drama|Romance</span><br><span class="line">26::Othello (1995)::Drama</span><br><span class="line">27::Now and Then (1995)::Drama</span><br><span class="line">28::Persuasion (1995)::Romance</span><br><span class="line">29::City of Lost Children, The (1995)::Adventure|Sci-Fi</span><br><span class="line">30::Shanghai Triad (Yao a yao yao dao waipo qiao) (1995)::Drama</span><br></pre></td></tr></table></figure></p>
<p>示例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [103]: mnames = [&apos;movie_id&apos;,&apos;title&apos;,&apos;genres&apos;]</span><br><span class="line"></span><br><span class="line">In [104]: movies = pd.read_table(&apos;movies.dat&apos;, sep=&apos;::&apos;,header=None,</span><br><span class="line">   .....:                        names = mnames)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [105]: movies[:10]</span><br><span class="line">Out[105]: </span><br><span class="line">   movie_id                               title                        genres</span><br><span class="line">0         1                    Toy Story (1995)   Animation|Children&apos;s|Comedy</span><br><span class="line">1         2                      Jumanji (1995)  Adventure|Children&apos;s|Fantasy</span><br><span class="line">2         3             Grumpier Old Men (1995)                Comedy|Romance</span><br><span class="line">3         4            Waiting to Exhale (1995)                  Comedy|Drama</span><br><span class="line">4         5  Father of the Bride Part II (1995)                        Comedy</span><br><span class="line">5         6                         Heat (1995)         Action|Crime|Thriller</span><br><span class="line">6         7                      Sabrina (1995)                Comedy|Romance</span><br><span class="line">7         8                 Tom and Huck (1995)          Adventure|Children&apos;s</span><br><span class="line">8         9                 Sudden Death (1995)                        Action</span><br><span class="line">9        10                    GoldenEye (1995)     Action|Adventure|Thriller</span><br></pre></td></tr></table></figure></p>
<p>　　要为每一个 genre 添加指标变量就需要做一些数据规整操作。首先，我们从数据集中抽取出不同的 genre 值（注意巧用 <code>set.union</code>）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">In [106]: genre_iter = (set(x.split(&apos;|&apos;)) for x in movies.genres)</span><br><span class="line"></span><br><span class="line">In [107]: genres = sorted(set.union(*genre_iter))</span><br><span class="line"></span><br><span class="line">In [108]: # 现在我们从一个全零 DataFrame 开始构建指标 DataFrame</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [109]: dummies = DataFrame(np.zeros((len(movies),len(genres))),</span><br><span class="line">   .....:                               columns = genres)</span><br><span class="line"></span><br><span class="line">In [110]: # 接下来，迭代每一部电影并将 dummies 各行的项设置为1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [111]: for i,gen in enumerate(movies.genres):</span><br><span class="line">   .....:     dummies.ix[i, gen.split(&apos;|&apos;)]=1</span><br><span class="line">   .....:     </span><br><span class="line"></span><br><span class="line">In [112]: # 在将其与 movie是合并起来</span><br><span class="line"></span><br><span class="line">In [113]:  movies_windic = movies.join(dummies.add_prefix(&apos;Genre_&apos;))</span><br><span class="line"></span><br><span class="line">In [114]: movies_windic.ix[0]</span><br><span class="line">Out[114]: </span><br><span class="line">movie_id                                      1</span><br><span class="line">title                          Toy Story (1995)</span><br><span class="line">genres              Animation|Children&apos;s|Comedy</span><br><span class="line">Genre_Action                                  0</span><br><span class="line">Genre_Adventure                               0</span><br><span class="line">Genre_Animation                               1</span><br><span class="line">Genre_Children&apos;s                              1</span><br><span class="line">Genre_Comedy                                  1</span><br><span class="line">Genre_Crime                                   0</span><br><span class="line">Genre_Drama                                   0</span><br><span class="line">Genre_Fantasy                                 0</span><br><span class="line">Genre_Horror                                  0</span><br><span class="line">Genre_Romance                                 0</span><br><span class="line">Genre_Sci-Fi                                  0</span><br><span class="line">Genre_Thriller                                0</span><br><span class="line">Name: 0, dtype: object</span><br></pre></td></tr></table></figure></p>
<p>　　一个对统计应用有用的秘诀是：结合 <code>get_dummies</code> 和诸如 <code>cut</code> 之类的离散化函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [127]: values = np.random.rand(10)</span><br><span class="line"></span><br><span class="line">In [128]: values</span><br><span class="line">Out[128]: </span><br><span class="line">array([ 0.65158907,  0.61562033,  0.53089883,  0.13941997,  0.48344916,</span><br><span class="line">        0.11734259,  0.07557764,  0.21863608,  0.90953758,  0.38441329])</span><br><span class="line"></span><br><span class="line">In [129]: bins = [0,0.2,0.4,0.6,0.8,1]</span><br><span class="line"></span><br><span class="line">In [130]: pd.get_dummies(pd.cut(values,bins))</span><br><span class="line">Out[130]: </span><br><span class="line">   (0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1]</span><br><span class="line">0         0           0           0           1         0</span><br><span class="line">1         0           0           0           1         0</span><br><span class="line">2         0           0           1           0         0</span><br><span class="line">3         1           0           0           0         0</span><br><span class="line">4         0           0           1           0         0</span><br><span class="line">5         1           0           0           0         0</span><br><span class="line">6         1           0           0           0         0</span><br><span class="line">7         0           1           0           0         0</span><br><span class="line">8         0           0           0           0         1</span><br><span class="line">9         0           1           0           0         0</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/">Komentar</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2016/05/17/PYTHON数据分析（PANDAS-VI-字符串操作）/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Lebih baru</strong>
            <div class="article-nav-title">
                
                    (no title)
                
            </div>
        </a>
    
    
        <a href="/2016/05/17/PYTHON数据分析（PANDAS-IV-重塑和轴向旋转）/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Lebih Tua</strong>
            <div class="article-nav-title"></div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div class="ds-thread" data-thread-key="2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/" data-title="" data-url="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/"></div>
    <style>
        #ds-thread #ds-reset .ds-textarea-wrapper {
            background: none;
        }
        #ds-reset .ds-avatar img {
            box-shadow: none;
        }
        #ds-reset .ds-gradient-bg {
            background: #f7f7f7;
        }
        #ds-thread #ds-reset li.ds-tab a {
            border-radius: 3px;
        }
        #ds-thread #ds-reset .ds-post-button {
            color: white;
            border: none;
            box-shadow: none;
            background: #d32;
            text-shadow: none;
            font-weight: normal;
            font-family: 'Microsoft Yahei';
        }
        #ds-thread #ds-reset .ds-post-button:hover {
            color: white;
            background: #DE594C;
        }
        #ds-thread #ds-reset .ds-post-button:active {
            background: #d32;
        }
        #ds-smilies-tooltip ul.ds-smilies-tabs li a.ds-current {
            color: white;
            background: #d32;
            box-shadow: none;
            text-shadow: none;
            font-weight: normal;
        }
    </style>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">terbaru</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:57:16.339Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:57:09.034Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:55.751Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:49.830Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:43.698Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">arsip</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tautan</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2016 FanShipKwan<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'freefarm'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>