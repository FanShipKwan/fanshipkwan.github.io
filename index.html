<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>因缺斯汀</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="因缺斯汀">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="因缺斯汀">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="因缺斯汀">
<meta name="twitter:description">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/open-sans/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
    

</head>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">因缺斯汀</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/123.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Cari" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'pos',
            PAGES: 'Pages',
            CATEGORIES: 'kategori',
            TAGS: 'tag',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Cari" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/123.png" />
            <h2 id="name">FanShip</h2>
            <h3 id="title">Local Farmer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>GuangZhou, China</span>
            <a id="follow" target="_blank" href="https://github.com/fanshipkwan/">IKUTI</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                13
                <span>pos</span>
            </div>
            <div class="article-info-block">
                0
                <span>tag</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    <td><a href="https://github.com/FanShipKwan/" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
                    
                    <td><a href="http://weibo.com/u/1846194245" target="_blank" title="weibo"><i class="fa fa-weibo"></i></a></td>
                    
                    <td><a href="/" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-PYTHON数据分析（PANDAS-XI-透视表和交叉表）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-XI-–-透视表和交叉表）"><a href="#PYTHON数据分析（PANDAS-XI-–-透视表和交叉表）" class="headerlink" title="PYTHON数据分析（PANDAS XI – 透视表和交叉表）"></a>PYTHON数据分析（PANDAS XI – 透视表和交叉表）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　　本实验将学习透视表和交叉表相关的知识<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-X-分组级运算和转换）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-X-–-分组级运算和转换）"><a href="#PYTHON数据分析（PANDAS-X-–-分组级运算和转换）" class="headerlink" title="PYTHON数据分析（PANDAS X – 分组级运算和转换）"></a>PYTHON数据分析（PANDAS X – 分组级运算和转换）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　　聚合只不过是分组运算中的一种而已。它是数据转换的一个特例，也就是说，它接受能够将一维数组简化为标量值的函数。在本节中，我们将学习 transform 和 apply 方法，它们能够执行更多其他的分组运算。<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-IX-数据聚合）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-IX-–-数据聚合）"><a href="#PYTHON数据分析（PANDAS-IX-–-数据聚合）" class="headerlink" title="PYTHON数据分析（PANDAS IX – 数据聚合）"></a>PYTHON数据分析（PANDAS IX – 数据聚合）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　　对于聚合，我指的是任何能够从数组产生标量值的数据转换过程。上一节实验课的例子中，我们已经用过一些，比如 mean、count、min 以及 sum 等。你可能想知道在 GroupBy 对象上调用 mean()时究竟发生了什么。<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-VIII-groupby-技术）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-VIII-–-groupby-技术）"><a href="#PYTHON数据分析（PANDAS-VIII-–-groupby-技术）" class="headerlink" title="PYTHON数据分析（PANDAS VIII – groupby 技术）"></a>PYTHON数据分析（PANDAS VIII – groupby 技术）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验简介"><a href="#一、实验简介" class="headerlink" title="一、实验简介"></a><strong>一、实验简介</strong></h2><p>　　对数据集进行分组并对各组应用一个函数（无论是聚合还是转换），这是数据分析工作中的重要环节。在数据集准备好之后，通常的任务就是计算分组统计或生成透视表。pandas 提供了一个灵活高效的 groupby 功能，它使我们能以一种自然的方式对数据集进行切片、切块、摘要等操作。<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-VII-绘图和可视化）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-VII-–-绘图和可视化）"><a href="#PYTHON数据分析（PANDAS-VII-–-绘图和可视化）" class="headerlink" title="PYTHON数据分析（PANDAS VII – 绘图和可视化）"></a>PYTHON数据分析（PANDAS VII – 绘图和可视化）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　　绘图是数据分析工作中最重要的任务之一，是探索过程的一部分，例如，帮我们找出异常值，必要的数据转换、得出有关模型的 idea 等。<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-VI-字符串操作）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="PYTHON数据分析（PANDAS-VI-–-字符串操作）"><a href="#PYTHON数据分析（PANDAS-VI-–-字符串操作）" class="headerlink" title="PYTHON数据分析（PANDAS VI – 字符串操作）"></a>PYTHON数据分析（PANDAS VI – 字符串操作）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验简介"><a href="#一、实验简介" class="headerlink" title="一、实验简介"></a><strong>一、实验简介</strong></h2><p>　　Python 能够成为流行的数据处理语言，部分原因是其简单易用的字符串和文本处理功能。大部分文本运算都直接做成了字符串对象的内置方法。对于更为复杂的模式匹配和文本操作，则可能需要用到正则表达式。pandas 对此进行了加强，它使你能够对整组数据应用字符串表达式和正则表达式，而且能处理烦人的缺失数据。</p>
<h2 id="二、字符串对象方法"><a href="#二、字符串对象方法" class="headerlink" title="二、字符串对象方法"></a><strong>二、字符串对象方法</strong></h2><p>　　对于大部分字符串处理应用而言，内置的字符串方法已经能够满足要求了。例如，以逗号分隔的字符串可以用 <code>split</code> 拆分成数段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">In [131]: val = &apos;a,b guido&apos;</span><br><span class="line"></span><br><span class="line">In [132]: val = &apos;a,b, guido&apos;</span><br><span class="line"></span><br><span class="line">In [133]: val.split(&apos;,&apos;)</span><br><span class="line">Out[133]: [&apos;a&apos;, &apos;b&apos;, &apos; guido&apos;]</span><br><span class="line"></span><br><span class="line">In [134]: #split  常常结合 strip（用于修剪空白符（包括换行符））</span><br><span class="line"></span><br><span class="line">In [135]: pieces = [x.strip() for x in val.split(&apos;,&apos;)]</span><br><span class="line"></span><br><span class="line">In [136]: pieces</span><br><span class="line">Out[136]: [&apos;a&apos;, &apos;b&apos;, &apos;guido&apos;]</span><br><span class="line"></span><br><span class="line">In [137]: # 利用加法，可以将这些子字符串以双冒号分隔符的形式连接起来</span><br><span class="line"></span><br><span class="line">In [138]: first, second, third = pieces</span><br><span class="line"></span><br><span class="line">In [139]: first + &quot;::&quot; + second + &quot;::&quot; + third</span><br><span class="line">Out[139]: &apos;a::b::guido&apos;</span><br><span class="line"></span><br><span class="line">In [140]: # 但这种方式并不是很实用，有一种更快捷的方法</span><br><span class="line"></span><br><span class="line">In [141]: &apos;::&apos;.join(pieces)</span><br><span class="line">Out[141]: &apos;a::b::guido&apos;</span><br><span class="line"></span><br><span class="line">In [142]: #  另一类方法关注的是子串定位</span><br><span class="line"></span><br><span class="line">In [143]: &apos; guido&apos; in val</span><br><span class="line">Out[143]: True</span><br><span class="line"></span><br><span class="line">In [144]: val.index(&apos;,&apos;)</span><br><span class="line">Out[144]: 1</span><br><span class="line"></span><br><span class="line">In [145]: val.find(&apos;:&apos;)</span><br><span class="line">Out[145]: -1</span><br><span class="line"></span><br><span class="line">In [146]: # count  函数可以返回指定子串出现的次数</span><br><span class="line"></span><br><span class="line">In [147]: val.count(&apos;,&apos;)</span><br><span class="line">Out[147]: 2</span><br><span class="line"></span><br><span class="line">In [148]: #replace  用于将指定模式替换成另一个模式</span><br><span class="line"></span><br><span class="line">In [149]: val.replace(&apos;,&apos;,&apos;::&apos;)</span><br><span class="line">Out[149]: &apos;a::b:: guido&apos;</span><br></pre></td></tr></table></figure></p>
<p><strong>Python 内置的字符串方法：</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>count</code></td>
<td>返回子串在字符串中的出现次数（非重叠）</td>
</tr>
<tr>
<td><code>endswith</code>、<code>startswith</code></td>
<td>如果字符串以某个后缀结尾（以某个前缀开头），则返回 True</td>
</tr>
<tr>
<td><code>join</code></td>
<td>将字符串用作连接其他字符串序列的分隔符</td>
</tr>
<tr>
<td><code>index</code></td>
<td>如果在字符串中找到子串，则返回第一个发现的子串的第一字符所在的位置。如果没找到，则引发 ValueError</td>
</tr>
<tr>
<td><code>find</code></td>
<td>如果在字符串中找到子串，则返回第一个发现的子串的第一字符所在的位置。如果没找到，则返回-1</td>
</tr>
<tr>
<td><code>rfind</code></td>
<td>如果在字符串中找到子串，则返回最后一个发现的子串的第一字符所在的位置。如果没找到，则返回-1</td>
</tr>
<tr>
<td><code>replace</code></td>
<td>用另一个字符串替换指定子串</td>
</tr>
<tr>
<td><code>strip</code>、<code>rstrip</code>、<code>lstrip</code></td>
<td>去除空白符（包括换行符）。相当于对各个元素执行 x.strip()（以及 rstrip、lstrip）</td>
</tr>
<tr>
<td><code>split</code></td>
<td>通过指定的分隔符将字符串拆分为一组子串</td>
</tr>
<tr>
<td><code>lower</code>、<code>upper</code></td>
<td>分别将字母字符转换为小写或大写</td>
</tr>
<tr>
<td><code>ljust</code>、<code>rjust</code></td>
<td>用空格（或其他字符）填充字符串的空白侧以返回符合最低宽度的字符串</td>
</tr>
</tbody>
</table>
<h2 id="三、正则表达式"><a href="#三、正则表达式" class="headerlink" title="三、正则表达式"></a><strong>三、正则表达式</strong></h2><p>　　正则表达式（通常称作 regex）提供了一种灵活的在文本中搜索或匹配字符串模式的方式。正则表达式是根据正则表达式语言编写的字符串。Python 内置的 re 模块负责对字符串应用正则表达式。（正则表达式的具体学习，请参照实验楼的相关课程，这里仅对 Python 内置模块使用的介绍）</p>
<p>　　re 模块的函数可以分为三大类：模式匹配、替换以及拆分。当然，它们之间是相辅相成的。一个 <code>regex</code> 描述了需要在文本中定位的一个模式，它可以用于许多目的。假如我们想要拆分一个字符串，分隔符为数量不定的一组空白符（制表符、空格、换行符等）。描述一个或多个空白符的 regex 是\s+<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [150]: import re</span><br><span class="line"></span><br><span class="line">In [151]: text = &apos;foo bar\t baz \tqux&apos;</span><br><span class="line"></span><br><span class="line">In [152]: re.split(&apos;\s+&apos;, text)</span><br><span class="line">Out[152]: [&apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos;, &apos;qux&apos;]</span><br><span class="line">　　调用re.split(&apos;\s+&apos;,text)时，正则表达式会先被编译，然后再在 text 上调用其 split 方法。你可以用 re.compile 自己编译 regex 以得到一个可重用的 regex 对象：</span><br><span class="line"></span><br><span class="line">In [153]: regex = re.compile(&apos;\s+&apos;)</span><br><span class="line"></span><br><span class="line">In [154]: regex.split(text)</span><br><span class="line">Out[154]: [&apos;foo&apos;, &apos;bar&apos;, &apos;baz&apos;, &apos;qux&apos;]</span><br><span class="line"></span><br><span class="line">In [155]: # 如果只希望得到匹配 regex 的所有模式，则可以使用 findall 方法</span><br><span class="line"></span><br><span class="line">In [156]:  regex.findall(text)</span><br><span class="line">Out[156]: [&apos; &apos;, &apos;\t &apos;, &apos; \t&apos;]</span><br></pre></td></tr></table></figure></p>
<p>　　如果打算对许多字符串应用同一条正则表达式，强烈建议通过<code>re.compile</code>创建 <code>regex</code> 对象，这样将可以节省大量的 CPU时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">　　`match` 和 `search` 跟 `findall` 功能类似。`findall` 返回的是字符串中所有的匹配项，而 `search` 则只返回第一个匹配项。`match` 更加严格，它只匹配字符串的首部。</span><br><span class="line"></span><br><span class="line">In [157]: text = &quot;&quot;&quot;Dave dave@google.com</span><br><span class="line">   .....: Steve steve@gmail.com</span><br><span class="line">   .....: Rob rob@gmail.com</span><br><span class="line">   .....: Ryan ryan@yahoo.com</span><br><span class="line">   .....: &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">In [158]: pattern = r&apos;[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]&#123;2,4&#125;&apos;</span><br><span class="line"></span><br><span class="line">In [159]: #re.IGNORECASE 的作用是使正则表达式对大小写不敏感</span><br><span class="line"></span><br><span class="line">In [160]:  regex = re.compile(pattern,flags = re.IGNORECASE)</span><br><span class="line"></span><br><span class="line">In [161]: #对 text 使用 findall 将得到一组电子邮件地址</span><br><span class="line"></span><br><span class="line">In [162]:  regex.findall(text)</span><br><span class="line">Out[162]: [&apos;dave@google.com&apos;, &apos;steve@gmail.com&apos;, &apos;rob@gmail.com&apos;, &apos;ryan@yahoo.com&apos;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [163]: #search 返回的是文本中第一个电子邮件地址</span><br><span class="line"></span><br><span class="line">In [164]: m = regex.search(text)</span><br><span class="line"></span><br><span class="line">In [165]: m</span><br><span class="line">Out[165]: &lt;_sre.SRE_Match at 0x109958d98&gt;</span><br><span class="line"></span><br><span class="line">In [166]: # 对于上面的 m，匹配项对象只能告诉我们模式在原字符串中的起始和结束位置</span><br><span class="line"></span><br><span class="line">In [167]:  text[m.start():m.end()]</span><br><span class="line">Out[167]: &apos;dave@google.com&apos;</span><br><span class="line"></span><br><span class="line">In [168]: #regex.match则返回 None，因为它只匹配出现在字符串开头的模式</span><br><span class="line"></span><br><span class="line">In [169]:  print regex.match(text)</span><br><span class="line">None</span><br></pre></td></tr></table></figure></p>
<p>　　<strong>正则表达式的方法如下：</strong><br>|方法|    说明|<br>|—|—|<br>|<code>findall</code>、<code>finditer</code>    |返回字符串中所有的非重叠匹配模式。<code>findall</code> 返回的是由所有模式组成的列表，而 <code>finditer</code> 则通过一个迭代器逐个返回<br>|<code>match</code>    |从字符串起始位置匹配模式，还可以对模式各部分进行分组。如果匹配到模式，则返回一个匹配项对象，否则返回 None<br>|<code>search</code>    |扫描整个字符串一匹配模式。如果找到则返回一个匹配项对象。跟 <code>match</code> 不同，其匹配项可以位于字符串的任意位置，而不仅仅是起始处<br>|<code>split</code>    |根据找到的模式将字符拆分为数段<br>|<code>sub</code>、<code>subn</code>    |将字符串中所有的（sub）或前 n个（<code>subn</code>）模式替换为指定表达式。在替换字符串中可以通过<code>\1</code>、<code>\2</code>等符号表示各分组项</p>
<h2 id="四、pandas-中矢量化的字符串函数"><a href="#四、pandas-中矢量化的字符串函数" class="headerlink" title="四、pandas 中矢量化的字符串函数"></a><strong>四、pandas 中矢量化的字符串函数</strong></h2><p>　　清理待分析的散乱数据时，常常需要做一些字符串规整化工作。更为复杂的情况是，含有字符串的列有时还含有缺失数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [184]: data = &#123;&apos;Dave&apos;: &apos;dave@google.com&apos;,&apos;Steve&apos;:&apos;steve@gmail.com&apos;,</span><br><span class="line">   .....:         &apos;Rob&apos;: &apos;rob@gmail.com&apos;,&apos;Wes&apos;:np.nan&#125;</span><br><span class="line"></span><br><span class="line">In [185]: data = Series(data)</span><br><span class="line"></span><br><span class="line">In [186]: data</span><br><span class="line">Out[186]: </span><br><span class="line">Dave     dave@google.com</span><br><span class="line">Rob        rob@gmail.com</span><br><span class="line">Steve    steve@gmail.com</span><br><span class="line">Wes                  NaN</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">In [187]: data.isnull()</span><br><span class="line">Out[187]: </span><br><span class="line">Dave     False</span><br><span class="line">Rob      False</span><br><span class="line">Steve    False</span><br><span class="line">Wes       True</span><br><span class="line">dtype: bool</span><br></pre></td></tr></table></figure></p>
<p>　　通过 <code>data.map</code>，所有字符串和正则表达式方法都能被应用于（传入 lambda表达式或其他函数）各个值，但是如果存在 <code>NA</code> 就会报错。为了解决这个问题，<code>Series</code> 有一些能够跳过 <code>NA</code> 值的字符串操作方法。通过 <code>Series</code> 的 <code>str</code> 属性即可访问这些方法。例如，我们可以通过 <code>str.contains</code>检查各个电子邮件地址是否含有“gmail”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [188]: data.str.contains(&apos;gmail&apos;)</span><br><span class="line">Out[188]: </span><br><span class="line">Dave     False</span><br><span class="line">Rob       True</span><br><span class="line">Steve     True</span><br><span class="line">Wes        NaN</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">In [189]: # 这里也可以使用正则表达式</span><br><span class="line"></span><br><span class="line">In [190]:  pattern</span><br><span class="line">Out[190]: &apos;([A-Z0-9._%+-]+)@([A-Z0-9.z-]+)\\.([A-Z]&#123;2,4&#125;)&apos;</span><br><span class="line"></span><br><span class="line">In [191]: data.str.findall(pattern, flags = re.IGNORECASE)</span><br><span class="line">Out[191]: </span><br><span class="line">Dave     [(dave, google, com)]</span><br><span class="line">Rob        [(rob, gmail, com)]</span><br><span class="line">Steve    [(steve, gmail, com)]</span><br><span class="line">Wes                        NaN</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure></p>
<p>　　有两个方法可以实现矢量化的元素获取操作：要么使用 <code>str.get</code>，要么在 <code>str</code> 属性上使用索引<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">In [192]: matches = data.str.match(pattern, flags = re.IGNORECASE)</span><br><span class="line"></span><br><span class="line">In [193]: matches</span><br><span class="line">Out[193]: </span><br><span class="line">Dave     (dave, google, com)</span><br><span class="line">Rob        (rob, gmail, com)</span><br><span class="line">Steve    (steve, gmail, com)</span><br><span class="line">Wes                      NaN</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">In [194]: matches.str.get(1)</span><br><span class="line">Out[194]: </span><br><span class="line">Dave     google</span><br><span class="line">Rob       gmail</span><br><span class="line">Steve     gmail</span><br><span class="line">Wes         NaN</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">In [195]: matches.str[0]</span><br><span class="line">Out[195]: </span><br><span class="line">Dave      dave</span><br><span class="line">Rob        rob</span><br><span class="line">Steve    steve</span><br><span class="line">Wes        NaN</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">In [196]: data.str[:5]</span><br><span class="line">Out[196]: </span><br><span class="line">Dave     dave@</span><br><span class="line">Rob      rob@g</span><br><span class="line">Steve    steve</span><br><span class="line">Wes        NaN</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure></p>
<p>　　<strong>下面给出了矢量化的字符串方法：</strong><br>|方法|    说明|<br>|—|—|<br>|<code>cat</code>    |实现元素级的字符串连接操作，可指定分隔符<br>|<code>contains</code>    |返回表示各字符是否含有指定模式的布尔型数组<br>|<code>count</code>    |模式的出现次数<br>|<code>endswith</code>、<code>startswitch</code>    |相当于对各个元素执行 <code>x.endswith(pattern)</code>或 <code>x.startswith(pattern)</code><br>|<code>findall</code>    |计算各字符串的模式列表<br>|<code>get</code>    |获取各元素的第 i 个字符<br>|<code>join</code>    |根据指定的分隔符将 Series 中各元素的字符串连接起来<br>|<code>len</code>    |计算各字符串的长度<br>|<code>lower</code>、<code>upper</code>    |转换大小写。相当于各个元素执行 <code>x.lower()</code>或 <code>x.upper()</code><br>|<code>match</code>    |根据指定的正则表达式对各个元素执行 <code>re.match</code><br>|<code>pad</code>    |在字符串的左边、右边或左右两边添加空白符<br>|<code>center</code>    |相当于 <code>pad(side = &#39;both&#39;)</code><br>|<code>repeat</code>    |重复值<br>|<code>replace</code>    |用指定字符串替换找到的模式<br>|<code>slice</code>    |对 Series 中的各个字符串进行子串截取<br>|<code>split</code>    |根据分隔符或正则表达式对字符串进行拆分<br>|<code>strip</code>、<code>rstrip</code>、<code>lstrip</code>    |去除空白符，包括换行符。相当于对各个元素执行 <code>x.strip()</code>、<code>x.rstrip()</code>、<code>x.lstrip()</code></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-VI-字符串操作）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-VI-字符串操作）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-V-数据转换）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="PYTHON数据分析（PANDAS-V-–数据转换）"><a href="#PYTHON数据分析（PANDAS-V-–数据转换）" class="headerlink" title="PYTHON数据分析（PANDAS V –数据转换）"></a>PYTHON数据分析（PANDAS V –数据转换）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验介绍"><a href="#一、实验介绍" class="headerlink" title="一、实验介绍"></a><strong>一、实验介绍</strong></h2><p>　到目前为止，之前介绍的都是数据的重排。而另一类重要操作则是过滤、清理以及其他的转换工作。今天我们就来更深入的学习数据的转换知识吧！</p>
<h2 id="二、移除重复数据"><a href="#二、移除重复数据" class="headerlink" title="二、移除重复数据"></a><strong>二、移除重复数据</strong></h2><p>　　DataFrame 中常常会出现重复行，举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">In [5]: data = DataFrame(&#123;&apos;k1&apos;:[&apos;one&apos;]*3+[&apos;two&apos;]*4,</span><br><span class="line">                  &apos;k2&apos;:[1,1,2,3,3,4,4]&#125;)</span><br><span class="line"></span><br><span class="line">In [6]: data</span><br><span class="line">Out[6]: </span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">1  one   1</span><br><span class="line">2  one   2</span><br><span class="line">3  two   3</span><br><span class="line">4  two   3</span><br><span class="line">5  two   4</span><br><span class="line">6  two   4</span><br><span class="line"></span><br><span class="line">In [7]: #DataFrame 的 duplicated 方法返回一个布尔型 Seriess</span><br><span class="line"></span><br><span class="line">In [8]: # 表示各行是否是重复行</span><br><span class="line"></span><br><span class="line">In [9]:  data.duplicated()</span><br><span class="line">Out[9]: </span><br><span class="line">0    False</span><br><span class="line">1     True</span><br><span class="line">2    False</span><br><span class="line">3    False</span><br><span class="line">4     True</span><br><span class="line">5    False</span><br><span class="line">6     True</span><br><span class="line">dtype: bool</span><br><span class="line"></span><br><span class="line">In [10]: #drop_duplicates 方法，用于返回一个移除了重复行的 DataFrame</span><br><span class="line"></span><br><span class="line">In [11]: data.drop_duplicates()</span><br><span class="line">Out[11]: </span><br><span class="line">    k1  k2</span><br><span class="line">0  one   1</span><br><span class="line">2  one   2</span><br><span class="line">3  two   3</span><br><span class="line">5  two   4</span><br><span class="line"></span><br><span class="line">In [12]: # 这个方法默认会判断全部列</span><br><span class="line"></span><br><span class="line">In [13]: #当然我们也可以指定部分列进行重复判断</span><br><span class="line"></span><br><span class="line">In [14]: data[&apos;v1&apos;] = range(7)</span><br><span class="line"></span><br><span class="line">In [15]: data</span><br><span class="line">Out[15]: </span><br><span class="line">    k1  k2  v1</span><br><span class="line">0  one   1   0</span><br><span class="line">1  one   1   1</span><br><span class="line">2  one   2   2</span><br><span class="line">3  two   3   3</span><br><span class="line">4  two   3   4</span><br><span class="line">5  two   4   5</span><br><span class="line">6  two   4   6</span><br><span class="line"></span><br><span class="line">In [16]: data.drop_duplicates([&apos;k1&apos;])</span><br><span class="line">Out[16]: </span><br><span class="line">    k1  k2  v1</span><br><span class="line">0  one   1   0</span><br><span class="line">3  two   3   3</span><br><span class="line"></span><br><span class="line">In [17]: # 上面是只通过k1列过滤重复项</span><br><span class="line">　　duplicated 和 drop_duplicates 默认保留的是第一个出现的值组合。传入 take_last = True 则保留最后一个：</span><br><span class="line"></span><br><span class="line">In [18]: data.drop_duplicates([&apos;k1&apos;,&apos;k2&apos;],take_last = True)</span><br><span class="line">Out[18]: </span><br><span class="line">    k1  k2  v1</span><br><span class="line">1  one   1   1</span><br><span class="line">2  one   2   2</span><br><span class="line">4  two   3   4</span><br><span class="line">6  two   4   6</span><br></pre></td></tr></table></figure></p>
<h2 id="三、利用函数或映射进行数据转换"><a href="#三、利用函数或映射进行数据转换" class="headerlink" title="三、利用函数或映射进行数据转换"></a><strong>三、利用函数或映射进行数据转换</strong></h2><p>　　在对数据集进行转换时，我们希望根据数组、<code>Series</code> 或 <code>DataFrame</code> 列中的值来实现工作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">In [4]: data = DataFrame(&#123;&apos;food&apos;:[&apos;bacon&apos;,&apos;pulled pork&apos;,&apos;bacon&apos;,</span><br><span class="line">   ...:                           &apos;pastrami&apos;,&apos;corned beef&apos;,&apos;bacon&apos;,</span><br><span class="line">   ...:                           &apos;pastrami&apos;,&apos;honey ham&apos;,&apos;nova lox&apos;],</span><br><span class="line">   ...:                   &apos;ounces&apos;:[4, 3, 12, 6, 7.5, 8, 3, 5, 6]&#125;)</span><br><span class="line"></span><br><span class="line">In [5]: data</span><br><span class="line">Out[5]: </span><br><span class="line">          food  ounces</span><br><span class="line">0        bacon     4.0</span><br><span class="line">1  pulled pork     3.0</span><br><span class="line">2        bacon    12.0</span><br><span class="line">3     pastrami     6.0</span><br><span class="line">4  corned beef     7.5</span><br><span class="line">5        bacon     8.0</span><br><span class="line">6     pastrami     3.0</span><br><span class="line">7    honey ham     5.0</span><br><span class="line">8     nova lox     6.0</span><br><span class="line"></span><br><span class="line">In [6]: # 我们添加一个食物来源</span><br><span class="line"></span><br><span class="line">In [7]:  meat_to_animal = &#123;</span><br><span class="line">   ...: &apos;bacon&apos;: &apos;pig&apos;,</span><br><span class="line">   ...: &apos;pulled pork&apos;: &apos;pig&apos;,</span><br><span class="line">   ...: &apos;pastrami&apos;: &apos;cow&apos;,</span><br><span class="line">   ...: &apos;corned beef&apos;: &apos;cow&apos;,</span><br><span class="line">   ...: &apos;honey ham&apos;: &apos;pig&apos;,</span><br><span class="line">   ...: &apos;nova lox&apos;: &apos;salmon&apos;</span><br><span class="line">   ...: &#125;</span><br><span class="line"></span><br><span class="line">In [8]: #Series 的 map 方法可以接受一个函数或含有映射关系的字典型对象</span><br><span class="line"></span><br><span class="line">In [9]: data[&apos;animal&apos;] = data[&apos;food&apos;].map(meat_to_animal)</span><br><span class="line"></span><br><span class="line">In [10]: data</span><br><span class="line">Out[10]: </span><br><span class="line">          food  ounces  animal</span><br><span class="line">0        bacon     4.0     pig</span><br><span class="line">1  pulled pork     3.0     pig</span><br><span class="line">2        bacon    12.0     pig</span><br><span class="line">3     pastrami     6.0     cow</span><br><span class="line">4  corned beef     7.5     cow</span><br><span class="line">5        bacon     8.0     pig</span><br><span class="line">6     pastrami     3.0     cow</span><br><span class="line">7    honey ham     5.0     pig</span><br><span class="line">8     nova lox     6.0  salmon</span><br><span class="line"></span><br><span class="line">In [11]: # 我们也可以传入一个能够完成全部工作的函数：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [12]: data[&apos;food&apos;].map(lambda x: meat_to_animal[x])</span><br><span class="line">Out[12]: </span><br><span class="line">0       pig</span><br><span class="line">1       pig</span><br><span class="line">2       pig</span><br><span class="line">3       cow</span><br><span class="line">4       cow</span><br><span class="line">5       pig</span><br><span class="line">6       cow</span><br><span class="line">7       pig</span><br><span class="line">8    salmon</span><br><span class="line">Name: food, dtype: object</span><br><span class="line">　　使用 map 是一种实现元素级转换以及其他数据清理工作的便捷方式。</span><br></pre></td></tr></table></figure></p>
<h2 id="四、替换值"><a href="#四、替换值" class="headerlink" title="四、替换值"></a><strong>四、替换值</strong></h2><p>　　利用 fillna 方法填充缺失数据可以看做值替换的一种特殊情况。虽然前面提到的 map 可用于修改对象的数据子集，而 replace 则提供了一种实现该功能的更简单、更灵活的方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">In [20]: data = Series([1., -999., 2., -999., -1000., 3.])</span><br><span class="line"></span><br><span class="line">In [21]: data</span><br><span class="line">Out[21]: </span><br><span class="line">0       1</span><br><span class="line">1    -999</span><br><span class="line">2       2</span><br><span class="line">3    -999</span><br><span class="line">4   -1000</span><br><span class="line">5       3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [22]: #接下来我想将-999 换成 NAN</span><br><span class="line"></span><br><span class="line">In [23]: data.replace(-999, np.nan)</span><br><span class="line">Out[23]: </span><br><span class="line">0       1</span><br><span class="line">1     NaN</span><br><span class="line">2       2</span><br><span class="line">3     NaN</span><br><span class="line">4   -1000</span><br><span class="line">5       3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [24]: # 如果我们想一次性换多个值</span><br><span class="line"></span><br><span class="line">In [25]:  data.replace([-999,-1000],np.nan)</span><br><span class="line">Out[25]: </span><br><span class="line">0     1</span><br><span class="line">1   NaN</span><br><span class="line">2     2</span><br><span class="line">3   NaN</span><br><span class="line">4   NaN</span><br><span class="line">5     3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [26]: data.replace([-999,-1000],[np.nan, 0])</span><br><span class="line">Out[26]: </span><br><span class="line">0     1</span><br><span class="line">1   NaN</span><br><span class="line">2     2</span><br><span class="line">3   NaN</span><br><span class="line">4     0</span><br><span class="line">5     3</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [27]: data.replace(&#123;-999: np.nan, -1000: 0&#125;)</span><br><span class="line">Out[27]: </span><br><span class="line">0     1</span><br><span class="line">1   NaN</span><br><span class="line">2     2</span><br><span class="line">3   NaN</span><br><span class="line">4     0</span><br><span class="line">5     3</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure></p>
<h2 id="五、重命名轴索引"><a href="#五、重命名轴索引" class="headerlink" title="五、重命名轴索引"></a><strong>五、重命名轴索引</strong></h2><p>　　跟 Series 中的值一样，轴标签也可以通过函数或映射进行转换，从而得到一个新对象。轴还可以被就地修改，而无需新建一个数据结构。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">In [28]: data = DataFrame(np.arange(12).reshape((3,4)),</span><br><span class="line">   ....:                  index = [&apos;Ohio&apos;,&apos;Colorado&apos;,&apos;New York&apos;],</span><br><span class="line">   ....:                  columns = [&apos;one&apos;,&apos;two&apos;,&apos;three&apos;,&apos;four&apos;])</span><br><span class="line"></span><br><span class="line">In [29]: # 跟 Series 一样，轴标签也有一个 map 方法</span><br><span class="line"></span><br><span class="line">In [30]: data.index.map(str.upper)</span><br><span class="line">Out[30]: array([&apos;OHIO&apos;, &apos;COLORADO&apos;, &apos;NEW YORK&apos;], dtype=object)</span><br><span class="line"></span><br><span class="line">In [31]: # 同样我们也可以赋值给 index</span><br><span class="line"></span><br><span class="line">In [32]: data.index = data.index.map(str.upper)</span><br><span class="line"></span><br><span class="line">In [33]: data</span><br><span class="line">Out[33]: </span><br><span class="line">          one  two  three  four</span><br><span class="line">OHIO        0    1      2     3</span><br><span class="line">COLORADO    4    5      6     7</span><br><span class="line">NEW YORK    8    9     10    11</span><br><span class="line"></span><br><span class="line">In [34]: # 如果想要创建数据集的转换版（不是修改原始数据）</span><br><span class="line"></span><br><span class="line">In [35]: data.rename(index = str.title,columns = str.upper)</span><br><span class="line">Out[35]: </span><br><span class="line">          ONE  TWO  THREE  FOUR</span><br><span class="line">Ohio        0    1      2     3</span><br><span class="line">Colorado    4    5      6     7</span><br><span class="line">New York    8    9     10    11</span><br><span class="line"></span><br><span class="line">In [36]: #rename 可以结合字典对象实现部分轴标签的更新</span><br><span class="line"></span><br><span class="line">In [37]: data.rename(index=&#123;&apos;OHIO&apos;:&apos;INDIANA&apos;&#125;,</span><br><span class="line">   ....:             columns = &#123;&apos;three&apos;:&apos;peekaboo&apos;&#125;)</span><br><span class="line">Out[37]: </span><br><span class="line">          one  two  peekaboo  four</span><br><span class="line">INDIANA     0    1         2     3</span><br><span class="line">COLORADO    4    5         6     7</span><br><span class="line">NEW YORK    8    9        10    11</span><br></pre></td></tr></table></figure></p>
<h2 id="六、离散化和面元划分"><a href="#六、离散化和面元划分" class="headerlink" title="六、离散化和面元划分"></a><strong>六、离散化和面元划分</strong></h2><p>　　为了便于分析，连续数据常常被离散化或拆分为“面元”（bin）。假设有一组人员数据，我们希望将它们划分为不同的年龄组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">In [39]: ages = [20, 22, 25, 27, 21, 23, 24, 18, 37, 31,61, 42, 48, 32]</span><br><span class="line"></span><br><span class="line">In [40]: # 接下来我们将这些数据分成18~25、26~35、35~60和60岁以上</span><br><span class="line"></span><br><span class="line">In [41]:  bins = [18, 25, 35, 60, 100]</span><br><span class="line"></span><br><span class="line">In [42]: cats = pd.cut(ages,bins)</span><br><span class="line"></span><br><span class="line">In [43]: cats</span><br><span class="line">Out[43]: </span><br><span class="line">[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]</span><br><span class="line">Length: 14</span><br><span class="line">Categories (4, object): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]</span><br><span class="line"></span><br><span class="line">In [44]: #pandas  用 cut 函数返回的是一个特殊的 Categorical 对象</span><br><span class="line"></span><br><span class="line">In [45]: #我们可以将其看做一组表示面元名称的字符串</span><br><span class="line"></span><br><span class="line">In [46]: #它含有一个表示不同分类名称的 levels 数组</span><br><span class="line"></span><br><span class="line">In [47]: cats.levels</span><br><span class="line">Out[47]: Index([u&apos;(18, 25]&apos;, u&apos;(25, 35]&apos;, u&apos;(35, 60]&apos;, u&apos;(60, 100]&apos;], dtype=&apos;object&apos;)</span><br><span class="line"></span><br><span class="line">In [48]: # 还有一个为年龄数据进行标号的 labels 属性</span><br><span class="line"></span><br><span class="line">In [49]:  cats.labels</span><br><span class="line">Out[49]: array([ 0,  0,  0,  1,  0,  0,  0, -1,  2,  1,  3,  2,  2,  1], dtype=int8)</span><br><span class="line"></span><br><span class="line">In [50]: pd.value_counts(cats)</span><br><span class="line">Out[50]: </span><br><span class="line">(18, 25]     6</span><br><span class="line">(35, 60]     3</span><br><span class="line">(25, 35]     3</span><br><span class="line">(60, 100]    1</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>
<p>　　<br>　　如果向 cut 传入的是面元的数量而不是确切的面元边界，则它会根据数据的最小值和最大值计算等长面元。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [56]: data = np.random.rand(20)</span><br><span class="line"></span><br><span class="line">In [57]: pd.cut(data, 4, precision = 2)</span><br><span class="line">Out[57]: </span><br><span class="line">[(0.72, 0.96], (0.25, 0.49], (0.49, 0.72], (0.72, 0.96], (0.25, 0.49], ..., (0.014, 0.25], (0.72, 0.96], (0.49, 0.72], (0.25, 0.49], (0.72, 0.96]]</span><br><span class="line">Length: 20</span><br><span class="line">Categories (4, object): [(0.014, 0.25] &lt; (0.25, 0.49] &lt; (0.49, 0.72] &lt; (0.72, 0.96]]</span><br></pre></td></tr></table></figure>
<p>　　<code>qcut</code> 是一个非常类似于<code>cut</code>的函数，它可以根据样本分位数对数据进行面元划分。根据数据的分布情况，<code>cut</code>可能无法使各个面元含有相同数量的数据点。而<code>qcut</code>由于使用的是样本分位数，因此可以得到大小基本相等的面元：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [58]: data = np.random.randn(1000)</span><br><span class="line"></span><br><span class="line">In [59]: cats = pd.qcut(data,4)</span><br><span class="line"></span><br><span class="line">In [60]: cats</span><br><span class="line">Out[60]: </span><br><span class="line">[(-0.699, 0.0415], [-3.0467, -0.699], (0.0415, 0.731], (0.731, 3.0755], [-3.0467, -0.699], ..., (0.0415, 0.731], [-3.0467, -0.699], (-0.699, 0.0415], [-3.0467, -0.699], [-3.0467, -0.699]]</span><br><span class="line">Length: 1000</span><br><span class="line">Categories (4, object): [[-3.0467, -0.699] &lt; (-0.699, 0.0415] &lt; (0.0415, 0.731] &lt; (0.731, 3.0755]]</span><br><span class="line"></span><br><span class="line">In [61]: pd.value_counts(cats)</span><br><span class="line">Out[61]: </span><br><span class="line">(0.731, 3.0755]      250</span><br><span class="line">(0.0415, 0.731]      250</span><br><span class="line">(-0.699, 0.0415]     250</span><br><span class="line">[-3.0467, -0.699]    250</span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure></p>
<h2 id="七、检测和过滤异常值"><a href="#七、检测和过滤异常值" class="headerlink" title="七、检测和过滤异常值"></a><strong>七、检测和过滤异常值</strong></h2><p>　　异常值（outlier）的过滤或变换运算在很大程度上其实就是数组运算。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">In [63]: np.random.seed(12345)</span><br><span class="line"></span><br><span class="line">In [64]: data = DataFrame(np.random.randn(1000,4))</span><br><span class="line"></span><br><span class="line">In [65]: data.describe()</span><br><span class="line">Out[65]: </span><br><span class="line">                 0            1            2            3</span><br><span class="line">count  1000.000000  1000.000000  1000.000000  1000.000000</span><br><span class="line">mean     -0.067684     0.067924     0.025598    -0.002298</span><br><span class="line">std       0.998035     0.992106     1.006835     0.996794</span><br><span class="line">min      -3.428254    -3.548824    -3.184377    -3.745356</span><br><span class="line">25%      -0.774890    -0.591841    -0.641675    -0.644144</span><br><span class="line">50%      -0.116401     0.101143     0.002073    -0.013611</span><br><span class="line">75%       0.616366     0.780282     0.680391     0.654328</span><br><span class="line">max       3.366626     2.653656     3.260383     3.927528</span><br><span class="line"></span><br><span class="line">In [66]: # 假设你想要找出某列中绝对值大小超过3的值</span><br><span class="line"></span><br><span class="line">In [67]:  col = data[3]</span><br><span class="line"></span><br><span class="line">In [68]: col[np.abs(col) &gt; 3]</span><br><span class="line">Out[68]: </span><br><span class="line">97     3.927528</span><br><span class="line">305   -3.399312</span><br><span class="line">400   -3.745356</span><br><span class="line">Name: 3, dtype: float64</span><br><span class="line"></span><br><span class="line">In [69]: # 要选出全部的绝对值大于三的行</span><br><span class="line"></span><br><span class="line">In [70]: data[(np.abs(data)&gt;3).any(1)]</span><br><span class="line">Out[70]: </span><br><span class="line">            0         1         2         3</span><br><span class="line">5   -0.539741  0.476985  3.248944 -1.021228</span><br><span class="line">97  -0.774363  0.552936  0.106061  3.927528</span><br><span class="line">102 -0.655054 -0.565230  3.176873  0.959533</span><br><span class="line">305 -2.315555  0.457246 -0.025907 -3.399312</span><br><span class="line">324  0.050188  1.951312  3.260383  0.963301</span><br><span class="line">400  0.146326  0.508391 -0.196713 -3.745356</span><br><span class="line">499 -0.293333 -0.242459 -3.056990  1.918403</span><br><span class="line">523 -3.428254 -0.296336 -0.439938 -0.867165</span><br><span class="line">586  0.275144  1.179227 -3.184377  1.369891</span><br><span class="line">808 -0.362528 -3.548824  1.553205 -2.186301</span><br><span class="line">900  3.366626 -2.372214  0.851010  1.332846</span><br><span class="line"></span><br><span class="line">In [71]: #根据这些条件，既可以轻松对值进行设置</span><br><span class="line"></span><br><span class="line">In [72]:  data[np.abs(data)&gt;3] = np.sign(data)*3</span><br><span class="line"></span><br><span class="line">In [73]: data.describe()</span><br><span class="line">Out[73]: </span><br><span class="line">                 0            1            2            3</span><br><span class="line">count  1000.000000  1000.000000  1000.000000  1000.000000</span><br><span class="line">mean     -0.067623     0.068473     0.025153    -0.002081</span><br><span class="line">std       0.995485     0.990253     1.003977     0.989736</span><br><span class="line">min      -3.000000    -3.000000    -3.000000    -3.000000</span><br><span class="line">25%      -0.774890    -0.591841    -0.641675    -0.644144</span><br><span class="line">50%      -0.116401     0.101143     0.002073    -0.013611</span><br><span class="line">75%       0.616366     0.780282     0.680391     0.654328</span><br><span class="line">max       3.000000     2.653656     3.000000     3.000000</span><br></pre></td></tr></table></figure></p>
<h2 id="八、排列和随机采样"><a href="#八、排列和随机采样" class="headerlink" title="八、排列和随机采样"></a><strong>八、排列和随机采样</strong></h2><p>　　利用 numpy.random.permutation 函数可以轻松实现对 Series 和 DataFrame 的列的排列工作（permuting，随机重排序）。通过需要排列的轴的长度调用 permutation，产生一个表示新顺序的整数数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [74]: df = DataFrame(np.arange(20).reshape(5,4))</span><br><span class="line"></span><br><span class="line">In [75]: sampler = np.random.permutation(5)</span><br><span class="line"></span><br><span class="line">In [76]: sampler</span><br><span class="line">Out[76]: array([1, 0, 2, 3, 4])</span><br><span class="line"></span><br><span class="line">In [77]: # 然后就可以在基于 ix 的索引操作或 take 函数中使用该数组</span><br><span class="line"></span><br><span class="line">In [78]:  df</span><br><span class="line">Out[78]: </span><br><span class="line">    0   1   2   3</span><br><span class="line">0   0   1   2   3</span><br><span class="line">1   4   5   6   7</span><br><span class="line">2   8   9  10  11</span><br><span class="line">3  12  13  14  15</span><br><span class="line">4  16  17  18  19</span><br><span class="line"></span><br><span class="line">In [79]: df.take(sampler)</span><br><span class="line">Out[79]: </span><br><span class="line">    0   1   2   3</span><br><span class="line">1   4   5   6   7</span><br><span class="line">0   0   1   2   3</span><br><span class="line">2   8   9  10  11</span><br><span class="line">3  12  13  14  15</span><br><span class="line">4  16  17  18  19</span><br></pre></td></tr></table></figure></p>
<p>　　如果不想用替换的方式选取随机子集，则可以使用 <code>permutation：</code>从 <code>permutation</code> 返回的数组中切下前 k 个元素，其中 k 为希望的子集大小。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [81]: df.take(np.random.permutation(len(df))[:3])</span><br><span class="line">Out[81]: </span><br><span class="line">    0   1   2   3</span><br><span class="line">1   4   5   6   7</span><br><span class="line">3  12  13  14  15</span><br><span class="line">4  16  17  18  19</span><br></pre></td></tr></table></figure></p>
<h2 id="九、计算指标-哑变量"><a href="#九、计算指标-哑变量" class="headerlink" title="九、计算指标/哑变量"></a><strong>九、计算指标/哑变量</strong></h2><p>　　另一种常用于统计建模或机器学习的转换方式：将分类变量（categorical variable）转换为“哑变量矩阵”（dummy matrix）或“指标矩阵”（indicator matrix）。如果 DataFrame 的某一列中含有 k 个不同的值，则可以派生出一个 k 列矩阵或 DataFrame（其值全为1和0）。pandas 有一个 get_dummies 函数可以实现该功能：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">In [89]: df = DataFrame(&#123;&apos;key&apos;:[&apos;b&apos;,&apos;b&apos;,&apos;a&apos;,&apos;c&apos;,&apos;a&apos;,&apos;b&apos;],</span><br><span class="line">   ....:                 &apos;data1&apos;:range(6)&#125;)</span><br><span class="line"></span><br><span class="line">In [90]: pd.get_dummies(df[&apos;key&apos;])</span><br><span class="line">Out[90]: </span><br><span class="line">   a  b  c</span><br><span class="line">0  0  1  0</span><br><span class="line">1  0  1  0</span><br><span class="line">2  1  0  0</span><br><span class="line">3  0  0  1</span><br><span class="line">4  1  0  0</span><br><span class="line">5  0  1  0</span><br><span class="line"></span><br><span class="line">In [91]: df</span><br><span class="line">Out[91]: </span><br><span class="line">   data1 key</span><br><span class="line">0      0   b</span><br><span class="line">1      1   b</span><br><span class="line">2      2   a</span><br><span class="line">3      3   c</span><br><span class="line">4      4   a</span><br><span class="line">5      5   b</span><br><span class="line"></span><br><span class="line">In [92]: # 我们可能想给指标 DataFrame 的列加上一个前缀，以便合并</span><br><span class="line"></span><br><span class="line">In [93]: dummies = pd.get_dummies(df[&apos;key&apos;],prefix = &apos;key&apos;)</span><br><span class="line"></span><br><span class="line">In [94]: df_with_dummy = df[[&apos;data1&apos;]].join(dummies)</span><br><span class="line"></span><br><span class="line">In [95]: df_with_dummy</span><br><span class="line">Out[95]: </span><br><span class="line">   data1  key_a  key_b  key_c</span><br><span class="line">0      0      0      1      0</span><br><span class="line">1      1      0      1      0</span><br><span class="line">2      2      1      0      0</span><br><span class="line">3      3      0      0      1</span><br><span class="line">4      4      1      0      0</span><br><span class="line">5      5      0      1      0</span><br></pre></td></tr></table></figure></p>
<p>　　如果 DataFrame 中的某行同属于多个分类，则事情就会有点复杂。同样的同学们，木木这里给大家一个数据文件，同学们把他们粘贴到文本文件中，等会会用到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1::Toy Story (1995)::Animation|Children&apos;s|Comedy</span><br><span class="line">2::Jumanji (1995)::Adventure|Children&apos;s|Fantasy</span><br><span class="line">3::Grumpier Old Men (1995)::Comedy|Romance</span><br><span class="line">4::Waiting to Exhale (1995)::Comedy|Drama</span><br><span class="line">5::Father of the Bride Part II (1995)::Comedy</span><br><span class="line">6::Heat (1995)::Action|Crime|Thriller</span><br><span class="line">7::Sabrina (1995)::Comedy|Romance</span><br><span class="line">8::Tom and Huck (1995)::Adventure|Children&apos;s</span><br><span class="line">9::Sudden Death (1995)::Action</span><br><span class="line">10::GoldenEye (1995)::Action|Adventure|Thriller</span><br><span class="line">11::American President, The (1995)::Comedy|Drama|Romance</span><br><span class="line">12::Dracula: Dead and Loving It (1995)::Comedy|Horror</span><br><span class="line">13::Balto (1995)::Animation|Children&apos;s</span><br><span class="line">14::Nixon (1995)::Drama</span><br><span class="line">15::Cutthroat Island (1995)::Action|Adventure|Romance</span><br><span class="line">16::Casino (1995)::Drama|Thriller</span><br><span class="line">17::Sense and Sensibility (1995)::Drama|Romance</span><br><span class="line">18::Four Rooms (1995)::Thriller</span><br><span class="line">19::Ace Ventura: When Nature Calls (1995)::Comedy</span><br><span class="line">20::Money Train (1995)::Action</span><br><span class="line">21::Get Shorty (1995)::Action|Comedy|Drama</span><br><span class="line">22::Copycat (1995)::Crime|Drama|Thriller</span><br><span class="line">23::Assassins (1995)::Thriller</span><br><span class="line">24::Powder (1995)::Drama|Sci-Fi</span><br><span class="line">25::Leaving Las Vegas (1995)::Drama|Romance</span><br><span class="line">26::Othello (1995)::Drama</span><br><span class="line">27::Now and Then (1995)::Drama</span><br><span class="line">28::Persuasion (1995)::Romance</span><br><span class="line">29::City of Lost Children, The (1995)::Adventure|Sci-Fi</span><br><span class="line">30::Shanghai Triad (Yao a yao yao dao waipo qiao) (1995)::Drama</span><br></pre></td></tr></table></figure></p>
<p>示例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [103]: mnames = [&apos;movie_id&apos;,&apos;title&apos;,&apos;genres&apos;]</span><br><span class="line"></span><br><span class="line">In [104]: movies = pd.read_table(&apos;movies.dat&apos;, sep=&apos;::&apos;,header=None,</span><br><span class="line">   .....:                        names = mnames)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [105]: movies[:10]</span><br><span class="line">Out[105]: </span><br><span class="line">   movie_id                               title                        genres</span><br><span class="line">0         1                    Toy Story (1995)   Animation|Children&apos;s|Comedy</span><br><span class="line">1         2                      Jumanji (1995)  Adventure|Children&apos;s|Fantasy</span><br><span class="line">2         3             Grumpier Old Men (1995)                Comedy|Romance</span><br><span class="line">3         4            Waiting to Exhale (1995)                  Comedy|Drama</span><br><span class="line">4         5  Father of the Bride Part II (1995)                        Comedy</span><br><span class="line">5         6                         Heat (1995)         Action|Crime|Thriller</span><br><span class="line">6         7                      Sabrina (1995)                Comedy|Romance</span><br><span class="line">7         8                 Tom and Huck (1995)          Adventure|Children&apos;s</span><br><span class="line">8         9                 Sudden Death (1995)                        Action</span><br><span class="line">9        10                    GoldenEye (1995)     Action|Adventure|Thriller</span><br></pre></td></tr></table></figure></p>
<p>　　要为每一个 genre 添加指标变量就需要做一些数据规整操作。首先，我们从数据集中抽取出不同的 genre 值（注意巧用 <code>set.union</code>）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">In [106]: genre_iter = (set(x.split(&apos;|&apos;)) for x in movies.genres)</span><br><span class="line"></span><br><span class="line">In [107]: genres = sorted(set.union(*genre_iter))</span><br><span class="line"></span><br><span class="line">In [108]: # 现在我们从一个全零 DataFrame 开始构建指标 DataFrame</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [109]: dummies = DataFrame(np.zeros((len(movies),len(genres))),</span><br><span class="line">   .....:                               columns = genres)</span><br><span class="line"></span><br><span class="line">In [110]: # 接下来，迭代每一部电影并将 dummies 各行的项设置为1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [111]: for i,gen in enumerate(movies.genres):</span><br><span class="line">   .....:     dummies.ix[i, gen.split(&apos;|&apos;)]=1</span><br><span class="line">   .....:     </span><br><span class="line"></span><br><span class="line">In [112]: # 在将其与 movie是合并起来</span><br><span class="line"></span><br><span class="line">In [113]:  movies_windic = movies.join(dummies.add_prefix(&apos;Genre_&apos;))</span><br><span class="line"></span><br><span class="line">In [114]: movies_windic.ix[0]</span><br><span class="line">Out[114]: </span><br><span class="line">movie_id                                      1</span><br><span class="line">title                          Toy Story (1995)</span><br><span class="line">genres              Animation|Children&apos;s|Comedy</span><br><span class="line">Genre_Action                                  0</span><br><span class="line">Genre_Adventure                               0</span><br><span class="line">Genre_Animation                               1</span><br><span class="line">Genre_Children&apos;s                              1</span><br><span class="line">Genre_Comedy                                  1</span><br><span class="line">Genre_Crime                                   0</span><br><span class="line">Genre_Drama                                   0</span><br><span class="line">Genre_Fantasy                                 0</span><br><span class="line">Genre_Horror                                  0</span><br><span class="line">Genre_Romance                                 0</span><br><span class="line">Genre_Sci-Fi                                  0</span><br><span class="line">Genre_Thriller                                0</span><br><span class="line">Name: 0, dtype: object</span><br></pre></td></tr></table></figure></p>
<p>　　一个对统计应用有用的秘诀是：结合 <code>get_dummies</code> 和诸如 <code>cut</code> 之类的离散化函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [127]: values = np.random.rand(10)</span><br><span class="line"></span><br><span class="line">In [128]: values</span><br><span class="line">Out[128]: </span><br><span class="line">array([ 0.65158907,  0.61562033,  0.53089883,  0.13941997,  0.48344916,</span><br><span class="line">        0.11734259,  0.07557764,  0.21863608,  0.90953758,  0.38441329])</span><br><span class="line"></span><br><span class="line">In [129]: bins = [0,0.2,0.4,0.6,0.8,1]</span><br><span class="line"></span><br><span class="line">In [130]: pd.get_dummies(pd.cut(values,bins))</span><br><span class="line">Out[130]: </span><br><span class="line">   (0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1]</span><br><span class="line">0         0           0           0           1         0</span><br><span class="line">1         0           0           0           1         0</span><br><span class="line">2         0           0           1           0         0</span><br><span class="line">3         1           0           0           0         0</span><br><span class="line">4         0           0           1           0         0</span><br><span class="line">5         1           0           0           0         0</span><br><span class="line">6         1           0           0           0         0</span><br><span class="line">7         0           1           0           0         0</span><br><span class="line">8         0           0           0           0         1</span><br><span class="line">9         0           1           0           0         0</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-V-数据转换）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-IV-重塑和轴向旋转）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="PYTHON数据分析（PANDAS-IV-–-重塑和轴向旋转）"><a href="#PYTHON数据分析（PANDAS-IV-–-重塑和轴向旋转）" class="headerlink" title="PYTHON数据分析（PANDAS IV – 重塑和轴向旋转）"></a>PYTHON数据分析（PANDAS IV – 重塑和轴向旋转）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验简介"><a href="#一、实验简介" class="headerlink" title="一、实验简介"></a><strong>一、实验简介</strong></h2><p>　　有许多重新排列表格型数据的基础运算。这些函数也称做重塑（reshape）或轴向旋转（pivot）运算。</p>
<h2 id="二、重塑层次化索引"><a href="#二、重塑层次化索引" class="headerlink" title="二、重塑层次化索引"></a><strong>二、重塑层次化索引</strong></h2><p>　　 层次化索引为 DataFrame 数据的重排任务提供了一种具有良好一致性的方式。主要功能有二：</p>
<blockquote>
<ul>
<li><code>stack</code>：将数据的列“旋转”为行</li>
<li><code>ustack</code>：将数据的行”旋转“为列</li>
</ul>
</blockquote>
<p>　  接下来看一个简单的 DataFrame，其中的行列索引均为字符串：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">In [183]:  data = DataFrame(np.arange(6).reshape((2,3)),</span><br><span class="line">   .....:                   index = pd.Index([&apos;Ohio&apos;,&apos;Colorado&apos;],name = &apos;state&apos;),</span><br><span class="line">   .....:                   columns = pd.Index([&apos;one&apos;,&apos;two&apos;,&apos;three&apos;],name = &apos;number&apos;))</span><br><span class="line"></span><br><span class="line">In [184]: data</span><br><span class="line">Out[184]: </span><br><span class="line">number    one  two  three</span><br><span class="line">state                    </span><br><span class="line">Ohio        0    1      2</span><br><span class="line">Colorado    3    4      5</span><br><span class="line"></span><br><span class="line">In [185]: # 使用该数据的 stack 方法即可将列转换为行，得到一个 Series</span><br><span class="line"></span><br><span class="line">In [186]: result = data.stack()</span><br><span class="line"></span><br><span class="line">In [187]: result</span><br><span class="line">Out[187]: </span><br><span class="line">state     number</span><br><span class="line">Ohio      one       0</span><br><span class="line">          two       1</span><br><span class="line">          three     2</span><br><span class="line">Colorado  one       3</span><br><span class="line">          two       4</span><br><span class="line">          three     5</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [188]: # 对于一个层次化索引的 Series，你可以用 unstack 将其重排位一个 DataFrame</span><br><span class="line"></span><br><span class="line">In [189]: result.unstack()</span><br><span class="line">Out[189]: </span><br><span class="line">number    one  two  three</span><br><span class="line">state                    </span><br><span class="line">Ohio        0    1      2</span><br><span class="line">Colorado    3    4      5</span><br><span class="line"></span><br><span class="line">In [190]: # 传入分层级别的编号或名称即可对其他级别进行unstack 操作</span><br><span class="line"></span><br><span class="line">In [191]:  result.unstack(0)</span><br><span class="line">Out[191]: </span><br><span class="line">state   Ohio  Colorado</span><br><span class="line">number                </span><br><span class="line">one        0         3</span><br><span class="line">two        1         4</span><br><span class="line">three      2         5</span><br><span class="line"></span><br><span class="line">In [192]: result.unstack(&apos;state&apos;)</span><br><span class="line">Out[192]: </span><br><span class="line">state   Ohio  Colorado</span><br><span class="line">number                </span><br><span class="line">one        0         3</span><br><span class="line">two        1         4</span><br><span class="line">three      2         5</span><br><span class="line"></span><br><span class="line">In [193]: # 如果不是所有的级别值都能在各分组中招到的话，则 unstack 操作可能会引入缺失数据</span><br><span class="line"></span><br><span class="line">In [195]: s1 = Series([0,1,2,3],index = [&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;])</span><br><span class="line"></span><br><span class="line">In [196]: s2 = Series([4,5,6],index = [&apos;c&apos;,&apos;d&apos;,&apos;e&apos;])</span><br><span class="line"></span><br><span class="line">In [197]: data2 = pd.concat([s1,s2],keys = [&apos;one&apos;,&apos;two&apos;])</span><br><span class="line"></span><br><span class="line">In [198]: data2.unstack()</span><br><span class="line">Out[198]: </span><br><span class="line">      a   b  c  d   e</span><br><span class="line">one   0   1  2  3 NaN</span><br><span class="line">two NaN NaN  4  5   6</span><br><span class="line"></span><br><span class="line">In [199]: data2</span><br><span class="line">Out[199]: </span><br><span class="line">one  a    0</span><br><span class="line">     b    1</span><br><span class="line">     c    2</span><br><span class="line">     d    3</span><br><span class="line">two  c    4</span><br><span class="line">     d    5</span><br><span class="line">     e    6</span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [200]: #stack  默认会滤除缺失数据，因此该运算是可逆的</span><br><span class="line"></span><br><span class="line">In [201]: data2.unstack().stack()</span><br><span class="line">Out[201]: </span><br><span class="line">one  a    0</span><br><span class="line">     b    1</span><br><span class="line">     c    2</span><br><span class="line">     d    3</span><br><span class="line">two  c    4</span><br><span class="line">     d    5</span><br><span class="line">     e    6</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [202]: data2.unstack().stack(dropna=False)</span><br><span class="line">Out[202]: </span><br><span class="line">one  a     0</span><br><span class="line">     b     1</span><br><span class="line">     c     2</span><br><span class="line">     d     3</span><br><span class="line">     e   NaN</span><br><span class="line">two  a   NaN</span><br><span class="line">     b   NaN</span><br><span class="line">     c     4</span><br><span class="line">     d     5</span><br><span class="line">     e     6</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [203]: # 在对 DataFrame 进行 unstack 操作时，作为旋转轴的级别将会成为结果中的最低级别：</span><br><span class="line"></span><br><span class="line">In [204]: df = DataFrame(&#123;&apos;left&apos;:result,&apos;right&apos;:result +5&#125;,</span><br><span class="line">   .....:                 columns = pd.Index([&apos;left&apos;,&apos;right&apos;],name = &apos;side&apos;))</span><br><span class="line"></span><br><span class="line">In [205]: df</span><br><span class="line">Out[205]: </span><br><span class="line">side             left  right</span><br><span class="line">state    number             </span><br><span class="line">Ohio     one        0      5</span><br><span class="line">         two        1      6</span><br><span class="line">         three      2      7</span><br><span class="line">Colorado one        3      8</span><br><span class="line">         two        4      9</span><br><span class="line">         three      5     10</span><br><span class="line"></span><br><span class="line">In [206]: df.unstack(&apos;state&apos;)</span><br><span class="line">Out[206]: </span><br><span class="line">side   left          right         </span><br><span class="line">state  Ohio Colorado  Ohio Colorado</span><br><span class="line">number                             </span><br><span class="line">one       0        3     5        8</span><br><span class="line">two       1        4     6        9</span><br><span class="line">three     2        5     7       10</span><br><span class="line"></span><br><span class="line">In [207]: df.unstack(&apos;state&apos;).stack(&apos;side&apos;)</span><br><span class="line">Out[207]: </span><br><span class="line">state         Ohio  Colorado</span><br><span class="line">number side                 </span><br><span class="line">one    left      0         3</span><br><span class="line">       right     5         8</span><br><span class="line">two    left      1         4</span><br><span class="line">       right     6         9</span><br><span class="line">three  left      2         5</span><br><span class="line">       right     7        10</span><br></pre></td></tr></table></figure></p>
<h2 id="三、将“长格式”旋转为“宽格式”"><a href="#三、将“长格式”旋转为“宽格式”" class="headerlink" title="三、将“长格式”旋转为“宽格式”"></a><strong>三、将“长格式”旋转为“宽格式”</strong></h2><p>时间序列数据通常是以所谓的“长格式”或“堆叠格式”存储在数据库和 CSV 中。</p>
<p>在这里，给大家一组数据，同学们把它粘贴到一个文本文件中，一会儿用到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">data,item,value</span><br><span class="line">1959-03-31 00:00:00,realgdp,2710.349</span><br><span class="line">1959-03-31 00:00:00,infl,0.000</span><br><span class="line">1959-03-31 00:00:00,unemp,5.800</span><br><span class="line">1959-06-30 00:00:00,realgdp,2778.801</span><br><span class="line">1959-06-30 00:00:00,infl,2.340</span><br><span class="line">1959-06-30 00:00:00,unemp,5.100</span><br><span class="line">1959-09-30 00:00:00,realgdp,2775.488</span><br><span class="line">1959-09-30 00:00:00,infl,2.740</span><br><span class="line">1959-09-30 00:00:00,unemp,5.300</span><br><span class="line">1959-12-30 00:00:00,realgdp,2785.204</span><br><span class="line">1959-12-30 00:00:00,infl,2.840</span><br><span class="line">1959-12-30 00:00:00,unemp,5.430</span><br><span class="line">1960-3-31 00:00:00,realgdp,2715.484</span><br><span class="line">1960-3-31 00:00:00,infl,2.640</span><br><span class="line">1960-3-31 00:00:00,unemp,5.330</span><br><span class="line">1960-6-30 00:00:00,realgdp,2775.320</span><br><span class="line">1960-6-30 00:00:00,infl,2.830</span><br><span class="line">1960-6-30 00:00:00,unemp,5.670</span><br><span class="line">1960-09-30 00:00:00,realgdp,2788.102</span><br><span class="line">1960-09-30 00:00:00,infl,2.530</span><br><span class="line">1960-09-30 00:00:00,unemp,5.411</span><br><span class="line">1960-12-30 00:00:00,realgdp,2782.192</span><br><span class="line">1960-12-30 00:00:00,infl,2.690</span><br><span class="line">1960-12-30 00:00:00,unemp,5.621</span><br></pre></td></tr></table></figure></p>
<p>　　我们先把数据读取出来：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [7]: data = pd.read_csv(&apos;data.csv&apos;)</span><br><span class="line"></span><br><span class="line">In [8]: data[:10]</span><br><span class="line">Out[8]: </span><br><span class="line">                  data     item     value</span><br><span class="line">0  1959-03-31 00:00:00  realgdp  2710.349</span><br><span class="line">1  1959-03-31 00:00:00     infl     0.000</span><br><span class="line">2  1959-03-31 00:00:00    unemp     5.800</span><br><span class="line">3  1959-06-30 00:00:00  realgdp  2778.801</span><br><span class="line">4  1959-06-30 00:00:00     infl     2.340</span><br><span class="line">5  1959-06-30 00:00:00    unemp     5.100</span><br><span class="line">6  1959-09-30 00:00:00  realgdp  2775.488</span><br><span class="line">7  1959-09-30 00:00:00     infl     2.740</span><br><span class="line">8  1959-09-30 00:00:00    unemp     5.300</span><br><span class="line">9  1959-12-30 00:00:00  realgdo  2785.204</span><br></pre></td></tr></table></figure></p>
<p>　　长格式的数据操作起来可能不那么轻松。我们可能更喜欢 DataFrame，不同的 <code>item</code> 值分别形成一列，<code>date</code> 列中的时间值作为索引。DataFrame 的 <code>pivot</code> 方法完全可以实现这个转换：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [15]: pivoted = data.pivot(&apos;data&apos;,&apos;item&apos;,&apos;value&apos;)</span><br><span class="line"></span><br><span class="line">In [16]: pivoted.head()</span><br><span class="line">Out[16]: </span><br><span class="line">item                 infl   realgdp  unemp</span><br><span class="line">data                                      </span><br><span class="line">1959-03-31 00:00:00  0.00  2710.349  5.800</span><br><span class="line">1959-06-30 00:00:00  2.34  2778.801  5.100</span><br><span class="line">1959-09-30 00:00:00  2.74  2775.488  5.300</span><br><span class="line">1959-12-30 00:00:00  2.84  2785.204  5.430</span><br><span class="line">1960-09-30 00:00:00  2.53  2788.102  5.411</span><br></pre></td></tr></table></figure></p>
<p>　　前两个参数值分别用作行和列索引的列名，最后一个参数值则是用于填充 DataFrame 的数据列的列名。假设有两个需要参与重塑的数据列：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">In [17]: data[&apos;value2&apos;] = np.random.randn(len(data))</span><br><span class="line"></span><br><span class="line">In [18]: data[:10]</span><br><span class="line">Out[18]: </span><br><span class="line">                  data     item     value    value2</span><br><span class="line">0  1959-03-31 00:00:00  realgdp  2710.349 -0.910427</span><br><span class="line">1  1959-03-31 00:00:00     infl     0.000 -1.165501</span><br><span class="line">2  1959-03-31 00:00:00    unemp     5.800  0.989307</span><br><span class="line">3  1959-06-30 00:00:00  realgdp  2778.801 -0.798133</span><br><span class="line">4  1959-06-30 00:00:00     infl     2.340  0.512493</span><br><span class="line">5  1959-06-30 00:00:00    unemp     5.100  0.402940</span><br><span class="line">6  1959-09-30 00:00:00  realgdp  2775.488 -0.584185</span><br><span class="line">7  1959-09-30 00:00:00     infl     2.740 -1.892180</span><br><span class="line">8  1959-09-30 00:00:00    unemp     5.300  1.610652</span><br><span class="line">9  1959-12-30 00:00:00  realgdp  2785.204 -1.431110</span><br><span class="line"></span><br><span class="line">In [19]: # 如果忽略最后一个参数，得到的 DataFrame 就会带有层次化</span><br><span class="line"></span><br><span class="line">In [20]:  pivoted = data.pivot(&apos;data&apos;,&apos;item&apos;)</span><br><span class="line"></span><br><span class="line">In [21]: pivoted[:5]</span><br><span class="line">Out[21]: </span><br><span class="line">                    value                     value2                    </span><br><span class="line">item                 infl   realgdp  unemp      infl   realgdp     unemp</span><br><span class="line">data                                                                    </span><br><span class="line">1959-03-31 00:00:00  0.00  2710.349  5.800 -1.165501 -0.910427  0.989307</span><br><span class="line">1959-06-30 00:00:00  2.34  2778.801  5.100  0.512493 -0.798133  0.402940</span><br><span class="line">1959-09-30 00:00:00  2.74  2775.488  5.300 -1.892180 -0.584185  1.610652</span><br><span class="line">1959-12-30 00:00:00  2.84  2785.204  5.430 -2.142333 -1.431110  0.555474</span><br><span class="line">1960-09-30 00:00:00  2.53  2788.102  5.411 -2.077777 -1.096230 -0.175941</span><br><span class="line"></span><br><span class="line">In [22]: pivoted[&apos;value&apos;][:5]</span><br><span class="line">Out[22]: </span><br><span class="line">item                 infl   realgdp  unemp</span><br><span class="line">data                                      </span><br><span class="line">1959-03-31 00:00:00  0.00  2710.349  5.800</span><br><span class="line">1959-06-30 00:00:00  2.34  2778.801  5.100</span><br><span class="line">1959-09-30 00:00:00  2.74  2775.488  5.300</span><br><span class="line">1959-12-30 00:00:00  2.84  2785.204  5.430</span><br><span class="line">1960-09-30 00:00:00  2.53  2788.102  5.411</span><br><span class="line"></span><br><span class="line">In [23]: # 注意，pivot 其实只是一个快捷方式</span><br><span class="line"></span><br><span class="line">In [24]: #用 set_index</span><br><span class="line"></span><br><span class="line">In [25]: # 再用 unstack 重塑</span><br><span class="line"></span><br><span class="line">In [26]:  unstacked = data.set_index([&apos;data&apos;,&apos;item&apos;]).unstack(&apos;item&apos;)</span><br><span class="line"></span><br><span class="line">In [27]: unstacked[:5]</span><br><span class="line">Out[27]: </span><br><span class="line">                    value                     value2                    </span><br><span class="line">item                 infl   realgdp  unemp      infl   realgdp     unemp</span><br><span class="line">data                                                                    </span><br><span class="line">1959-03-31 00:00:00  0.00  2710.349  5.800 -1.165501 -0.910427  0.989307</span><br><span class="line">1959-06-30 00:00:00  2.34  2778.801  5.100  0.512493 -0.798133  0.402940</span><br><span class="line">1959-09-30 00:00:00  2.74  2775.488  5.300 -1.892180 -0.584185  1.610652</span><br><span class="line">1959-12-30 00:00:00  2.84  2785.204  5.430 -2.142333 -1.431110  0.555474</span><br><span class="line">1960-09-30 00:00:00  2.53  2788.102  5.411 -2.077777 -1.096230 -0.175941</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IV-重塑和轴向旋转）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-IV-重塑和轴向旋转）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-III-合并数据集）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-III-–合并数据集）"><a href="#PYTHON数据分析（PANDAS-III-–合并数据集）" class="headerlink" title="PYTHON数据分析（PANDAS III –合并数据集）"></a>PYTHON数据分析（PANDAS III –合并数据集）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程<a href="https://www.shiyanlou.com/courses/387">《PYTHON数据分析》</a></p>
</blockquote>
<h2 id="一、实验简介"><a href="#一、实验简介" class="headerlink" title="一、实验简介"></a><strong>一、实验简介</strong></h2><p>　　数据分析和建模方面的大量编程工作都是用在数据准备上：加载、清理、转换以及重塑。有时候，存放在文件或数据库中的数据并不能满足你的数据处理应用的要求。许多人都选择使用普通编程语言（如 Python、Perl、R或 Java）或 UNIX 文本处理工具（如 sed 或 awk）对数据格式进行专门处理。幸运的是，pandas 和 Python 标准库提供了一组高级的、灵活的、高效的核心函数和算法，它们使你能轻松地将数据规整化为正确的形式。<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-III-合并数据集）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-III-合并数据集）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-III-合并数据集）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-PYTHON数据分析（PANDAS-II-使用数据库）" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
        <div class="article-entry" itemprop="articleBody">
        
            <p><h1 id="PYTHON数据分析（PANDAS-II-–使用数据库）"><a href="#PYTHON数据分析（PANDAS-II-–使用数据库）" class="headerlink" title="PYTHON数据分析（PANDAS II –使用数据库）"></a>PYTHON数据分析（PANDAS II –使用数据库）</h1><p>标签： PYTHON科学计算</p>
<hr>
<blockquote>
<p>转载自实验楼作者 <strong>木木同学</strong> 的课程[《PYTHON数据分析》][1]</p>
</blockquote>
<h2 id="一、实验简介"><a href="#一、实验简介" class="headerlink" title="一、实验简介"></a><strong>一、实验简介</strong></h2><p>　　在许多应用中，数据很少取自文本文件，因为用这种方式存储大量数据很低效。基于 SQL 的关系型数据库（如 SQL Server、PostgreSQL 和 MySQL 等）使用非常广泛，此外还有一些非 SQL（即所谓的 NoSQL）型数据库也变得非常流行。<br></p>
            <p class="article-more-link">
                <a href="/2016/05/17/PYTHON数据分析（PANDAS-II-使用数据库）/#more">Read More</a>
            </p>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">

    <div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone">QQ空间</a>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_tqq">腾讯微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<style>
    .jiathis_style div:first-child:not(.jiadiv_01) {
        width: auto !important;
        border: none !important;
    }
    .jiathis_style .jiadiv_01 {
        margin: 10px 0;
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .jiathis_style .jiadiv_01 div:first-child {
        display: none;
    }
    .jiathis_style .jiadiv_02 {
        padding: 7px 0 !important;
    }
    .jiathis_style .jiadiv_02 .jiatitle {
        width: 85px;
        border: none;
        height: auto;
        margin: 3px 10px;
        padding: 6px 10px;
        border-radius: 4px;
    }
    .jiathis_style .jiadiv_02 .jiatitle:hover {
        border: none;
    }
    .jiathis_style .jiadiv_02 .jiatitle:nth-child(even) {
        margin-left: 0;
    }
    .jiathis_style .jtico:hover {
        opacity: 1;
    }
    .jiathis_style .ckepopBottom,
    .jiathis_style .centerBottom {
        width: auto !important;
        padding: 5px;
        background: #f7f7f7;
    }
</style>



</div>

            
    
        <a href="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-II-使用数据库）/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://yoursite.com/2016/05/17/PYTHON数据分析（PANDAS-II-使用数据库）/">Komentar</a>
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Berikutnya &raquo;</a>
    </nav>
</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">terbaru</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-XI-透视表和交叉表）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:57:16.339Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-X-分组级运算和转换）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:57:09.034Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-IX-数据聚合）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:55.751Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-VIII-groupby-技术）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:49.830Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2016/05/17/PYTHON数据分析（PANDAS-VII-绘图和可视化）/" class="title"></a></p>
                            <p class="item-date"><time datetime="2016-05-17T15:56:43.698Z" itemprop="datePublished">2016-05-17</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">arsip</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tautan</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2016 FanShipKwan<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'freefarm'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>